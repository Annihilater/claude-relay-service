import{E as it}from"./element-plus-B8Fs_0jW.js";import{aR as Be,r as A,c as P,q as Ce,V as at,o as $e,x as d,y as a,z as e,I as le,C as T,P as m,R as xe,J as rt,L as b,B as ne,K as S,aq as Y,Q as z,ac as N,T as dt,a5 as fe,D as ut,_ as Ke,Y as re,an as pe,O as k,aa as ke,aX as be,al as ge}from"./vue-vendor-CKToUHZx.js";import{s as V}from"./toast-BvwA7Mwb.js";import{a as G,_ as de}from"./index-Dfil49HZ.js";import"./vendor-BDiMbLwQ.js";const Te=Be("clients",{state:()=>({supportedClients:[],loading:!1,error:null}),actions:{async loadSupportedClients(){if(this.supportedClients.length>0)return this.supportedClients;this.loading=!0,this.error=null;try{const f=await G.get("/admin/supported-clients");return f.success?this.supportedClients=f.data||[]:(this.error=f.message||"加载支持的客户端失败",console.error("Failed to load supported clients:",this.error)),this.supportedClients}catch(f){return this.error=f.message||"加载支持的客户端失败",console.error("Error loading supported clients:",f),[]}finally{this.loading=!1}}}}),He=Be("apiKeys",()=>{const f=A([]),W=A(!1),p=A(null),R=A("all"),I=A(""),g=A("asc"),w=async()=>{W.value=!0,p.value=null;try{const $=await G.get("/admin/api-keys");if($.success)f.value=$.data||[];else throw new Error($.message||"获取API Keys失败")}catch($){throw p.value=$.message,$}finally{W.value=!1}};return{apiKeys:f,loading:W,error:p,statsTimeRange:R,sortBy:I,sortOrder:g,fetchApiKeys:w,createApiKey:async $=>{W.value=!0,p.value=null;try{const y=await G.post("/admin/api-keys",$);if(y.success)return await w(),y.data;throw new Error(y.message||"创建API Key失败")}catch(y){throw p.value=y.message,y}finally{W.value=!1}},updateApiKey:async($,y)=>{W.value=!0,p.value=null;try{const x=await G.put(`/admin/api-keys/${$}`,y);if(x.success)return await w(),x;throw new Error(x.message||"更新API Key失败")}catch(x){throw p.value=x.message,x}finally{W.value=!1}},toggleApiKey:async $=>{W.value=!0,p.value=null;try{const y=await G.put(`/admin/api-keys/${$}/toggle`);if(y.success)return await w(),y;throw new Error(y.message||"切换状态失败")}catch(y){throw p.value=y.message,y}finally{W.value=!1}},renewApiKey:async($,y)=>{W.value=!0,p.value=null;try{const x=await G.put(`/admin/api-keys/${$}`,y);if(x.success)return await w(),x;throw new Error(x.message||"续期失败")}catch(x){throw p.value=x.message,x}finally{W.value=!1}},deleteApiKey:async $=>{W.value=!0,p.value=null;try{const y=await G.delete(`/admin/api-keys/${$}`);if(y.success)return await w(),y;throw new Error(y.message||"删除失败")}catch(y){throw p.value=y.message,y}finally{W.value=!1}},fetchApiKeyStats:async($,y="all")=>{try{const x=await G.get(`/admin/api-keys/${$}/stats`,{params:{timeRange:y}});if(x.success)return x.stats;throw new Error(x.message||"获取统计失败")}catch(x){return console.error("获取API Key统计失败:",x),null}},fetchTags:async()=>{try{const $=await G.get("/admin/api-keys/tags");if($.success)return $.data||[];throw new Error($.message||"获取标签失败")}catch($){return console.error("获取标签失败:",$),[]}},sortApiKeys:$=>{I.value===$?g.value=g.value==="asc"?"desc":"asc":(I.value=$,g.value="asc")},reset:()=>{f.value=[],W.value=!1,p.value=null,R.value="all",I.value="",g.value="asc"}}}),ct={class:"flex-shrink-0 border-b border-gray-200 p-3"},mt={class:"relative"},pt={class:"custom-scrollbar flex-1 overflow-y-auto"},xt={class:"text-gray-700"},ft={key:0},gt=["onClick"],yt={class:"flex items-center justify-between"},bt={class:"text-gray-700"},vt={class:"text-xs text-gray-500"},wt={key:1},ht={class:"bg-gray-50 px-4 py-2 text-xs font-semibold text-gray-500"},$t=["onClick"],kt={class:"flex items-center justify-between"},At={class:"text-gray-700"},Ct={class:"text-xs text-gray-400"},Kt={key:2},_t=["onClick"],Dt={class:"flex items-center justify-between"},Lt={class:"text-gray-700"},It={class:"text-xs text-gray-400"},Mt={key:3,class:"px-4 py-8 text-center text-gray-500"},Tt={__name:"AccountSelector",props:{modelValue:{type:String,default:""},platform:{type:String,required:!0,validator:f=>["claude","gemini"].includes(f)},accounts:{type:Array,default:()=>[]},groups:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},placeholder:{type:String,default:"请选择账号"},defaultOptionText:{type:String,default:"使用共享账号池"}},emits:["update:modelValue"],setup(f,{emit:W}){const p=f,R=W,I=A(!1),g=A(""),w=A(null),q=A(null),C=A({}),E=A(null),L=A(""),v=P(()=>{if(!p.modelValue)return p.defaultOptionText;if(p.modelValue.startsWith("group:")){const s=p.modelValue.substring(6),c=p.groups.find(j=>j.id===s);return c?`${c.name} (${c.memberCount||0} 个成员)`:""}if(p.modelValue.startsWith("console:")){const s=p.modelValue.substring(8),c=p.accounts.find(j=>j.id===s&&j.platform==="claude-console");return c?`${c.name} (${K(c)})`:""}const l=p.accounts.find(s=>s.id===p.modelValue);return l?`${l.name} (${K(l)})`:""}),K=l=>{if(!l)return"未知";if(l.isActive===!1)switch(l.status){case"unauthorized":return"未授权";case"error":return"Token错误";case"created":return"待验证";case"rate_limited":return"限流中";default:return"异常"}return"正常"},r=P(()=>[...p.accounts].sort((l,s)=>{const c=new Date(l.createdAt||0);return new Date(s.createdAt||0)-c})),i=P(()=>{if(!g.value)return p.groups;const l=g.value.toLowerCase();return p.groups.filter(s=>s.name.toLowerCase().includes(l))}),B=P(()=>{let l=r.value.filter(s=>s.accountType==="dedicated"&&(p.platform==="claude"?s.platform==="claude-oauth":s.platform!=="claude-console"));if(g.value){const s=g.value.toLowerCase();l=l.filter(c=>c.name.toLowerCase().includes(s))}return l}),$=P(()=>{if(p.platform!=="claude")return[];let l=r.value.filter(s=>s.accountType==="dedicated"&&s.platform==="claude-console");if(g.value){const s=g.value.toLowerCase();l=l.filter(c=>c.name.toLowerCase().includes(s))}return l}),y=P(()=>i.value.length>0||B.value.length>0||$.value.length>0),x=l=>{if(!l)return"";const s=new Date(l),j=(new Date-s)/(1e3*60*60);return j<24?"今天创建":j<48?"昨天创建":j<168?`${Math.floor(j/24)} 天前`:s.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"})},O=()=>{if(!I.value||!q.value||!E.value)return;const l=E.value;if(!l)return;const s=l.getBoundingClientRect(),c=window.innerHeight,j=window.innerWidth,Z=c-s.bottom,F=s.top,te=8,Q=Z-te,oe=F-te;let se=!1,ie=Q;L.value==="above"&&oe>=150?(se=!0,ie=oe):L.value==="below"&&Q>=150?(se=!1,ie=Q):oe>Q&&Q<200&&(se=!0,ie=oe),L.value=se?"above":"below";let ue=s.left;const ye=s.width;ue+ye>j-te&&(ue=j-ye-te),ue<te&&(ue=te),C.value={position:"fixed",left:`${ue}px`,width:`${s.width}px`,maxHeight:`${Math.min(ie,400)}px`,...se?{bottom:`${c-s.top}px`}:{top:`${s.bottom}px`}}},ee=()=>{if(!I.value&&E.value){const l=E.value.getBoundingClientRect(),c=window.innerHeight-l.bottom,j=8;C.value={position:"fixed",left:`${l.left}px`,width:`${l.width}px`,maxHeight:`${Math.min(c-j,400)}px`,top:`${l.bottom}px`}}I.value=!I.value,I.value&&ut(()=>{var l;O(),(l=w.value)==null||l.focus()})},H=l=>{R("update:modelValue",l||""),I.value=!1,g.value=""},J=()=>{},X=()=>{var l;g.value="",(l=w.value)==null||l.focus()},D=l=>{var s,c;!((s=E.value)!=null&&s.contains(l.target))&&!((c=q.value)!=null&&c.contains(l.target))&&(I.value=!1)},n=()=>{I.value&&O()};return Ce(()=>{document.addEventListener("click",D),window.addEventListener("scroll",n,!0),window.addEventListener("resize",O)}),at(()=>{document.removeEventListener("click",D),window.removeEventListener("scroll",n,!0),window.removeEventListener("resize",O)}),$e(I,l=>{l||(g.value="",L.value="")}),(l,s)=>(a(),d("div",{ref_key:"triggerRef",ref:E,class:"relative"},[e("div",{class:T(["form-input flex w-full cursor-pointer items-center justify-between",{"opacity-50":f.disabled}]),onClick:s[0]||(s[0]=c=>!f.disabled&&ee())},[e("span",{class:T(f.modelValue?"text-gray-900":"text-gray-500")},m(v.value),3),e("i",{class:T(["fas fa-chevron-down text-gray-400 transition-transform duration-200",{"rotate-180":I.value}])},null,2)],2),(a(),le(fe,{to:"body"},[xe(dt,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:rt(()=>[I.value?(a(),d("div",{key:0,ref_key:"dropdownRef",ref:q,class:"absolute z-50 flex flex-col rounded-lg border border-gray-200 bg-white shadow-lg",style:ne(C.value)},[e("div",ct,[e("div",mt,[S(e("input",{ref_key:"searchInput",ref:w,"onUpdate:modelValue":s[1]||(s[1]=c=>g.value=c),class:"form-input w-full text-sm",placeholder:"搜索账号名称...",style:{"padding-left":"40px","padding-right":"36px"},type:"text",onInput:J},null,544),[[Y,g.value]]),s[4]||(s[4]=e("i",{class:"fas fa-search pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-sm text-gray-400"},null,-1)),g.value?(a(),d("button",{key:0,class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",type:"button",onClick:X},s[3]||(s[3]=[e("i",{class:"fas fa-times text-sm"},null,-1)]))):b("",!0)])]),e("div",pt,[e("div",{class:T(["cursor-pointer px-4 py-2 transition-colors hover:bg-gray-50",{"bg-blue-50":!f.modelValue}]),onClick:s[2]||(s[2]=c=>H(null))},[e("span",xt,m(f.defaultOptionText),1)],2),i.value.length>0?(a(),d("div",ft,[s[5]||(s[5]=e("div",{class:"bg-gray-50 px-4 py-2 text-xs font-semibold text-gray-500"},"调度分组",-1)),(a(!0),d(z,null,N(i.value,c=>(a(),d("div",{key:`group:${c.id}`,class:T(["cursor-pointer px-4 py-2 transition-colors hover:bg-gray-50",{"bg-blue-50":f.modelValue===`group:${c.id}`}]),onClick:j=>H(`group:${c.id}`)},[e("div",yt,[e("span",bt,m(c.name),1),e("span",vt,m(c.memberCount||0)+" 个成员",1)])],10,gt))),128))])):b("",!0),B.value.length>0?(a(),d("div",wt,[e("div",ht,m(f.platform==="claude"?"Claude OAuth 专属账号":"OAuth 专属账号"),1),(a(!0),d(z,null,N(B.value,c=>(a(),d("div",{key:c.id,class:T(["cursor-pointer px-4 py-2 transition-colors hover:bg-gray-50",{"bg-blue-50":f.modelValue===c.id}]),onClick:j=>H(c.id)},[e("div",kt,[e("div",null,[e("span",At,m(c.name),1),e("span",{class:T(["ml-2 rounded-full px-2 py-0.5 text-xs",c.isActive?"bg-green-100 text-green-700":c.status==="unauthorized"?"bg-orange-100 text-orange-700":"bg-red-100 text-red-700"])},m(K(c)),3)]),e("span",Ct,m(x(c.createdAt)),1)])],10,$t))),128))])):b("",!0),f.platform==="claude"&&$.value.length>0?(a(),d("div",Kt,[s[6]||(s[6]=e("div",{class:"bg-gray-50 px-4 py-2 text-xs font-semibold text-gray-500"}," Claude Console 专属账号 ",-1)),(a(!0),d(z,null,N($.value,c=>(a(),d("div",{key:c.id,class:T(["cursor-pointer px-4 py-2 transition-colors hover:bg-gray-50",{"bg-blue-50":f.modelValue===`console:${c.id}`}]),onClick:j=>H(`console:${c.id}`)},[e("div",Dt,[e("div",null,[e("span",Lt,m(c.name),1),e("span",{class:T(["ml-2 rounded-full px-2 py-0.5 text-xs",c.isActive?"bg-green-100 text-green-700":c.status==="unauthorized"?"bg-orange-100 text-orange-700":"bg-red-100 text-red-700"])},m(K(c)),3)]),e("span",It,m(x(c.createdAt)),1)])],10,_t))),128))])):b("",!0),g.value&&!y.value?(a(),d("div",Mt,s[7]||(s[7]=[e("i",{class:"fas fa-search mb-2 text-2xl"},null,-1),e("p",{class:"text-sm"},"没有找到匹配的账号",-1)]))):b("",!0)])],4)):b("",!0)]),_:1})]))],512))}},Ae=de(Tt,[["__scopeId","data-v-b315d95a"]]),Rt={class:"modal fixed inset-0 z-50 flex items-center justify-center p-3 sm:p-4"},St={class:"modal-content mx-auto flex max-h-[90vh] w-full max-w-4xl flex-col p-4 sm:p-6"},jt={class:"mb-4 flex items-center justify-between"},Pt={class:"rounded-lg border border-blue-200 bg-gradient-to-r from-blue-50 to-indigo-50 p-3 sm:p-4"},Et={class:"flex items-center gap-3 sm:gap-4"},Vt={class:"flex cursor-pointer items-center"},qt={class:"flex cursor-pointer items-center"},Ut={key:0,class:"mt-3"},Wt={class:"flex items-center gap-4"},Ot={class:"flex-1"},Ft={class:"flex items-center gap-2"},Gt={class:"mt-2 flex items-start text-xs text-amber-600"},zt=["placeholder"],Bt={key:0,class:"mt-1 text-xs text-red-500"},Ht={class:"space-y-4"},Nt={key:0},Yt={class:"flex flex-wrap gap-2"},Qt=["onClick"],Jt={key:1},Xt={class:"flex flex-wrap gap-2"},Zt=["onClick"],es={class:"flex gap-2"},ts=["onKeypress"],ss={class:"rounded-lg border border-blue-200 bg-blue-50 p-3"},ls={class:"space-y-2"},os={class:"grid grid-cols-1 gap-2 lg:grid-cols-3"},ns={class:"space-y-2"},is={class:"flex gap-2"},as={key:0,class:"mt-3"},rs=["min"],ds={key:1,class:"mt-2 text-xs text-gray-500"},us={class:"flex gap-4"},cs={class:"flex cursor-pointer items-center"},ms={class:"flex cursor-pointer items-center"},ps={class:"flex cursor-pointer items-center"},xs={class:"mb-2 flex items-center justify-between"},fs=["disabled"],gs={class:"grid grid-cols-1 gap-3"},ys={class:"mb-2 flex items-center"},bs={key:0,class:"space-y-2 rounded-lg border border-red-200 bg-red-50 p-3"},vs={class:"mb-2 flex min-h-[24px] flex-wrap gap-1"},ws=["onClick"],hs={key:0,class:"text-xs text-gray-400"},$s={class:"flex gap-2"},ks=["onKeydown"],As={class:"mb-2 flex items-center"},Cs={key:0,class:"rounded-lg border border-green-200 bg-green-50 p-3"},Ks={class:"space-y-1"},_s=["id","value"],Ds=["for"],Ls={class:"text-sm font-medium text-gray-700"},Is={class:"block text-xs text-gray-500"},Ms={class:"flex gap-3 pt-2"},Ts=["disabled"],Rs={key:0,class:"loading-spinner mr-2"},Ss={key:1,class:"fas fa-plus mr-2"},js={__name:"CreateApiKeyModal",props:{accounts:{type:Object,default:()=>({claude:[],gemini:[]})}},emits:["close","success","batch-success"],setup(f,{emit:W}){const p=f,R=W,I=Te(),g=He(),w=A(!1),q=A(!1),C=A({claude:[],gemini:[],claudeGroups:[],geminiGroups:[]}),E=A({name:""}),L=A(""),v=A([]),K=P(()=>v.value.filter(l=>!i.tags.includes(l))),r=A([]),i=Ke({createType:"single",batchCount:10,name:"",description:"",tokenLimit:"",rateLimitWindow:"",rateLimitRequests:"",concurrencyLimit:"",dailyCostLimit:"",expireDuration:"",customExpireDate:"",expiresAt:null,permissions:"all",claudeAccountId:"",geminiAccountId:"",enableModelRestriction:!1,restrictedModels:[],modelInput:"",enableClientRestriction:!1,allowedClients:[],tags:[]});Ce(async()=>{r.value=await I.loadSupportedClients(),v.value=await g.fetchTags(),p.accounts&&(C.value={claude:p.accounts.claude||[],gemini:p.accounts.gemini||[],claudeGroups:p.accounts.claudeGroups||[],geminiGroups:p.accounts.geminiGroups||[]})});const B=async()=>{var l,s;q.value=!0;try{const[c,j,Z,F]=await Promise.all([G.get("/admin/claude-accounts"),G.get("/admin/claude-console-accounts"),G.get("/admin/gemini-accounts"),G.get("/admin/account-groups")]),te=[];if(c.success&&((l=c.data)==null||l.forEach(Q=>{te.push({...Q,platform:"claude-oauth",isDedicated:Q.accountType==="dedicated"})})),j.success&&((s=j.data)==null||s.forEach(Q=>{te.push({...Q,platform:"claude-console",isDedicated:Q.accountType==="dedicated"})})),C.value.claude=te,Z.success&&(C.value.gemini=(Z.data||[]).map(Q=>({...Q,isDedicated:Q.accountType==="dedicated"}))),F.success){const Q=F.data||[];C.value.claudeGroups=Q.filter(oe=>oe.platform==="claude"),C.value.geminiGroups=Q.filter(oe=>oe.platform==="gemini")}V("账号列表已刷新","success")}catch{V("刷新账号列表失败","error")}finally{q.value=!1}},$=P(()=>{const l=new Date;return l.setMinutes(l.getMinutes()+1),l.toISOString().slice(0,16)}),y=()=>{if(!i.expireDuration){i.expiresAt=null;return}if(i.expireDuration==="custom")return;const l=new Date,c=i.expireDuration.match(/(\d+)([dhmy])/);if(c){const[,j,Z]=c,F=parseInt(j);switch(Z){case"d":l.setDate(l.getDate()+F);break;case"h":l.setHours(l.getHours()+F);break;case"m":l.setMonth(l.getMonth()+F);break;case"y":l.setFullYear(l.getFullYear()+F);break}i.expiresAt=l.toISOString()}},x=()=>{i.customExpireDate&&(i.expiresAt=new Date(i.customExpireDate).toISOString())},O=l=>new Date(l).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),ee=()=>{i.modelInput&&!i.restrictedModels.includes(i.modelInput)&&(i.restrictedModels.push(i.modelInput),i.modelInput="")},H=l=>{i.restrictedModels.splice(l,1)},J=()=>{if(L.value&&L.value.trim()){const l=L.value.trim();i.tags.includes(l)||i.tags.push(l),L.value=""}},X=l=>{i.tags.includes(l)||i.tags.push(l)},D=l=>{i.tags.splice(l,1)},n=async()=>{if(E.value.name="",!i.name||!i.name.trim()){E.value.name="请输入API Key名称";return}if(i.createType==="batch"&&(!i.batchCount||i.batchCount<2||i.batchCount>500)){V("批量创建数量必须在 2-500 之间","error");return}w.value=!0;try{const l={description:i.description||void 0,tokenLimit:i.tokenLimit!==""&&i.tokenLimit!==null?parseInt(i.tokenLimit):null,rateLimitWindow:i.rateLimitWindow!==""&&i.rateLimitWindow!==null?parseInt(i.rateLimitWindow):null,rateLimitRequests:i.rateLimitRequests!==""&&i.rateLimitRequests!==null?parseInt(i.rateLimitRequests):null,concurrencyLimit:i.concurrencyLimit!==""&&i.concurrencyLimit!==null?parseInt(i.concurrencyLimit):0,dailyCostLimit:i.dailyCostLimit!==""&&i.dailyCostLimit!==null?parseFloat(i.dailyCostLimit):0,expiresAt:i.expiresAt||void 0,permissions:i.permissions,tags:i.tags.length>0?i.tags:void 0,enableModelRestriction:i.enableModelRestriction,restrictedModels:i.restrictedModels,enableClientRestriction:i.enableClientRestriction,allowedClients:i.allowedClients};if(i.claudeAccountId&&(i.claudeAccountId.startsWith("console:")?(l.claudeConsoleAccountId=i.claudeAccountId.substring(8),delete l.claudeAccountId):(l.claudeAccountId=i.claudeAccountId,delete l.claudeConsoleAccountId)),i.geminiAccountId&&(l.geminiAccountId=i.geminiAccountId),i.createType==="single"){const s={...l,name:i.name},c=await G.post("/admin/api-keys",s);c.success?(V("API Key 创建成功","success"),R("success",c.data),R("close")):V(c.message||"创建失败","error")}else{const s={...l,createType:"batch",baseName:i.name,count:i.batchCount},c=await G.post("/admin/api-keys/batch",s);c.success?(V(`成功创建 ${c.data.length} 个 API Key`,"success"),R("batch-success",c.data),R("close")):V(c.message||"批量创建失败","error")}}catch{V("创建失败","error")}finally{w.value=!1}};return(l,s)=>(a(),le(fe,{to:"body"},[e("div",Rt,[e("div",St,[e("div",jt,[s[30]||(s[30]=e("div",{class:"flex items-center gap-2 sm:gap-3"},[e("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 sm:h-10 sm:w-10 sm:rounded-xl"},[e("i",{class:"fas fa-key text-sm text-white sm:text-base"})]),e("h3",{class:"text-lg font-bold text-gray-900 sm:text-xl"},"创建新的 API Key")],-1)),e("button",{class:"p-1 text-gray-400 transition-colors hover:text-gray-600",onClick:s[0]||(s[0]=c=>l.$emit("close"))},s[29]||(s[29]=[e("i",{class:"fas fa-times text-lg sm:text-xl"},null,-1)]))]),e("form",{class:"modal-scroll-content custom-scrollbar flex-1 space-y-4",onSubmit:re(n,["prevent"])},[e("div",Pt,[e("div",{class:T(["flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",i.createType==="batch"?"mb-3":""])},[s[33]||(s[33]=e("label",{class:"flex h-full items-center text-xs font-semibold text-gray-700 sm:text-sm"},"创建类型",-1)),e("div",Et,[e("label",Vt,[S(e("input",{"onUpdate:modelValue":s[1]||(s[1]=c=>i.createType=c),class:"mr-1.5 text-blue-600 sm:mr-2",type:"radio",value:"single"},null,512),[[pe,i.createType]]),s[31]||(s[31]=e("span",{class:"flex items-center text-xs text-gray-700 sm:text-sm"},[e("i",{class:"fas fa-key mr-1 text-xs"}),k(" 单个创建 ")],-1))]),e("label",qt,[S(e("input",{"onUpdate:modelValue":s[2]||(s[2]=c=>i.createType=c),class:"mr-1.5 text-blue-600 sm:mr-2",type:"radio",value:"batch"},null,512),[[pe,i.createType]]),s[32]||(s[32]=e("span",{class:"flex items-center text-xs text-gray-700 sm:text-sm"},[e("i",{class:"fas fa-layer-group mr-1 text-xs"}),k(" 批量创建 ")],-1))])])],2),i.createType==="batch"?(a(),d("div",Ut,[e("div",Wt,[e("div",Ot,[s[35]||(s[35]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600"},"创建数量",-1)),e("div",Ft,[S(e("input",{"onUpdate:modelValue":s[3]||(s[3]=c=>i.batchCount=c),class:"form-input w-full text-sm",max:"500",min:"2",placeholder:"输入数量 (2-500)",required:"",type:"number"},null,512),[[Y,i.batchCount,void 0,{number:!0}]]),s[34]||(s[34]=e("div",{class:"whitespace-nowrap text-xs text-gray-500"},"最大支持 500 个",-1))])])]),e("p",Gt,[s[36]||(s[36]=e("i",{class:"fas fa-info-circle mr-1 mt-0.5 flex-shrink-0"},null,-1)),e("span",null,"批量创建时，每个 Key 的名称会自动添加序号后缀，例如："+m(i.name||"MyKey")+"_1, "+m(i.name||"MyKey")+"_2 ...",1)])])):b("",!0)]),e("div",null,[s[37]||(s[37]=e("label",{class:"mb-1.5 block text-xs font-semibold text-gray-700 sm:mb-2 sm:text-sm"},[k("名称 "),e("span",{class:"text-red-500"},"*")],-1)),S(e("input",{"onUpdate:modelValue":s[4]||(s[4]=c=>i.name=c),class:T(["form-input w-full text-sm",{"border-red-500":E.value.name}]),placeholder:i.createType==="batch"?"输入基础名称（将自动添加序号）":"为您的 API Key 取一个名称",required:"",type:"text",onInput:s[5]||(s[5]=c=>E.value.name="")},null,42,zt),[[Y,i.name]]),E.value.name?(a(),d("p",Bt,m(E.value.name),1)):b("",!0)]),e("div",null,[s[45]||(s[45]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700"},"标签",-1)),e("div",Ht,[i.tags.length>0?(a(),d("div",Nt,[s[39]||(s[39]=e("div",{class:"mb-2 text-xs font-medium text-gray-600"},"已选择的标签:",-1)),e("div",Yt,[(a(!0),d(z,null,N(i.tags,(c,j)=>(a(),d("span",{key:"selected-"+j,class:"inline-flex items-center gap-1 rounded-full bg-blue-100 px-3 py-1 text-sm text-blue-800"},[k(m(c)+" ",1),e("button",{class:"ml-1 hover:text-blue-900",type:"button",onClick:Z=>D(j)},s[38]||(s[38]=[e("i",{class:"fas fa-times text-xs"},null,-1)]),8,Qt)]))),128))])])):b("",!0),K.value.length>0?(a(),d("div",Jt,[s[41]||(s[41]=e("div",{class:"mb-2 text-xs font-medium text-gray-600"},"点击选择已有标签:",-1)),e("div",Xt,[(a(!0),d(z,null,N(K.value,c=>(a(),d("button",{key:"available-"+c,class:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-3 py-1 text-sm text-gray-700 transition-colors hover:bg-blue-100 hover:text-blue-700",type:"button",onClick:j=>X(c)},[s[40]||(s[40]=e("i",{class:"fas fa-tag text-xs text-gray-500"},null,-1)),k(" "+m(c),1)],8,Zt))),128))])])):b("",!0),e("div",null,[s[43]||(s[43]=e("div",{class:"mb-2 text-xs font-medium text-gray-600"},"创建新标签:",-1)),e("div",es,[S(e("input",{"onUpdate:modelValue":s[6]||(s[6]=c=>L.value=c),class:"form-input flex-1",placeholder:"输入新标签名称",type:"text",onKeypress:ke(re(J,["prevent"]),["enter"])},null,40,ts),[[Y,L.value]]),e("button",{class:"rounded-lg bg-green-500 px-4 py-2 text-white transition-colors hover:bg-green-600",type:"button",onClick:J},s[42]||(s[42]=[e("i",{class:"fas fa-plus"},null,-1)]))])]),s[44]||(s[44]=e("p",{class:"text-xs text-gray-500"},"用于标记不同团队或用途，方便筛选管理",-1))])]),e("div",ss,[s[53]||(s[53]=e("div",{class:"mb-2 flex items-center gap-2"},[e("div",{class:"flex h-6 w-6 flex-shrink-0 items-center justify-center rounded bg-blue-500"},[e("i",{class:"fas fa-tachometer-alt text-xs text-white"})]),e("h4",{class:"text-sm font-semibold text-gray-800"},"速率限制设置 (可选)")],-1)),e("div",ls,[e("div",os,[e("div",null,[s[46]||(s[46]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700"},"时间窗口 (分钟)",-1)),S(e("input",{"onUpdate:modelValue":s[7]||(s[7]=c=>i.rateLimitWindow=c),class:"form-input w-full text-sm",min:"1",placeholder:"无限制",type:"number"},null,512),[[Y,i.rateLimitWindow]]),s[47]||(s[47]=e("p",{class:"ml-2 mt-0.5 text-xs text-gray-500"},"时间段单位",-1))]),e("div",null,[s[48]||(s[48]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700"},"请求次数限制",-1)),S(e("input",{"onUpdate:modelValue":s[8]||(s[8]=c=>i.rateLimitRequests=c),class:"form-input w-full text-sm",min:"1",placeholder:"无限制",type:"number"},null,512),[[Y,i.rateLimitRequests]]),s[49]||(s[49]=e("p",{class:"ml-2 mt-0.5 text-xs text-gray-500"},"窗口内最大请求",-1))]),e("div",null,[s[50]||(s[50]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700"},"Token 限制",-1)),S(e("input",{"onUpdate:modelValue":s[9]||(s[9]=c=>i.tokenLimit=c),class:"form-input w-full text-sm",placeholder:"无限制",type:"number"},null,512),[[Y,i.tokenLimit]]),s[51]||(s[51]=e("p",{class:"ml-2 mt-0.5 text-xs text-gray-500"},"窗口内最大Token",-1))])]),s[52]||(s[52]=e("div",{class:"rounded-lg bg-blue-100 p-2"},[e("h5",{class:"mb-1 text-xs font-semibold text-blue-800"},"💡 使用示例"),e("div",{class:"space-y-0.5 text-xs text-blue-700"},[e("div",null,[e("strong",null,"示例1:"),k(" 时间窗口=60，请求次数=1000 → 每60分钟最多1000次请求 ")]),e("div",null,[e("strong",null,"示例2:"),k(" 时间窗口=1，Token=10000 → 每分钟最多10,000个Token ")]),e("div",null,[e("strong",null,"示例3:"),k(" 窗口=30，请求=50，Token=100000 → 每30分钟50次请求且不超10万Token ")])])],-1))])]),e("div",null,[s[55]||(s[55]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700"},"每日费用限制 (美元)",-1)),e("div",ns,[e("div",is,[e("button",{class:"rounded bg-gray-100 px-2 py-1 text-xs font-medium hover:bg-gray-200",type:"button",onClick:s[10]||(s[10]=c=>i.dailyCostLimit="50")}," $50 "),e("button",{class:"rounded bg-gray-100 px-2 py-1 text-xs font-medium hover:bg-gray-200",type:"button",onClick:s[11]||(s[11]=c=>i.dailyCostLimit="100")}," $100 "),e("button",{class:"rounded bg-gray-100 px-2 py-1 text-xs font-medium hover:bg-gray-200",type:"button",onClick:s[12]||(s[12]=c=>i.dailyCostLimit="200")}," $200 "),e("button",{class:"rounded bg-gray-100 px-2 py-1 text-xs font-medium hover:bg-gray-200",type:"button",onClick:s[13]||(s[13]=c=>i.dailyCostLimit="")}," 自定义 ")]),S(e("input",{"onUpdate:modelValue":s[14]||(s[14]=c=>i.dailyCostLimit=c),class:"form-input w-full",min:"0",placeholder:"0 表示无限制",step:"0.01",type:"number"},null,512),[[Y,i.dailyCostLimit]]),s[54]||(s[54]=e("p",{class:"text-xs text-gray-500"}," 设置此 API Key 每日的费用限制，超过限制将拒绝请求，0 或留空表示无限制 ",-1))])]),e("div",null,[s[56]||(s[56]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700"},"并发限制 (可选)",-1)),S(e("input",{"onUpdate:modelValue":s[15]||(s[15]=c=>i.concurrencyLimit=c),class:"form-input w-full",min:"0",placeholder:"0 表示无限制",type:"number"},null,512),[[Y,i.concurrencyLimit]]),s[57]||(s[57]=e("p",{class:"mt-2 text-xs text-gray-500"}," 设置此 API Key 可同时处理的最大请求数，0 或留空表示无限制 ",-1))]),e("div",null,[s[58]||(s[58]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700"},"备注 (可选)",-1)),S(e("textarea",{"onUpdate:modelValue":s[16]||(s[16]=c=>i.description=c),class:"form-input w-full resize-none text-sm",placeholder:"描述此 API Key 的用途...",rows:"2"},null,512),[[Y,i.description]])]),e("div",null,[s[60]||(s[60]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700"},"有效期限",-1)),S(e("select",{"onUpdate:modelValue":s[17]||(s[17]=c=>i.expireDuration=c),class:"form-input w-full",onChange:y},s[59]||(s[59]=[e("option",{value:""},"永不过期",-1),e("option",{value:"1d"},"1 天",-1),e("option",{value:"7d"},"7 天",-1),e("option",{value:"30d"},"30 天",-1),e("option",{value:"90d"},"90 天",-1),e("option",{value:"180d"},"180 天",-1),e("option",{value:"365d"},"365 天",-1),e("option",{value:"custom"},"自定义日期",-1)]),544),[[be,i.expireDuration]]),i.expireDuration==="custom"?(a(),d("div",as,[S(e("input",{"onUpdate:modelValue":s[18]||(s[18]=c=>i.customExpireDate=c),class:"form-input w-full",min:$.value,type:"datetime-local",onChange:x},null,40,rs),[[Y,i.customExpireDate]])])):b("",!0),i.expiresAt?(a(),d("p",ds," 将于 "+m(O(i.expiresAt))+" 过期 ",1)):b("",!0)]),e("div",null,[s[64]||(s[64]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700"},"服务权限",-1)),e("div",us,[e("label",cs,[S(e("input",{"onUpdate:modelValue":s[19]||(s[19]=c=>i.permissions=c),class:"mr-2",type:"radio",value:"all"},null,512),[[pe,i.permissions]]),s[61]||(s[61]=e("span",{class:"text-sm text-gray-700"},"全部服务",-1))]),e("label",ms,[S(e("input",{"onUpdate:modelValue":s[20]||(s[20]=c=>i.permissions=c),class:"mr-2",type:"radio",value:"claude"},null,512),[[pe,i.permissions]]),s[62]||(s[62]=e("span",{class:"text-sm text-gray-700"},"仅 Claude",-1))]),e("label",ps,[S(e("input",{"onUpdate:modelValue":s[21]||(s[21]=c=>i.permissions=c),class:"mr-2",type:"radio",value:"gemini"},null,512),[[pe,i.permissions]]),s[63]||(s[63]=e("span",{class:"text-sm text-gray-700"},"仅 Gemini",-1))])]),s[65]||(s[65]=e("p",{class:"mt-2 text-xs text-gray-500"},"控制此 API Key 可以访问哪些服务",-1))]),e("div",null,[e("div",xs,[s[66]||(s[66]=e("label",{class:"text-sm font-semibold text-gray-700"},"专属账号绑定 (可选)",-1)),e("button",{class:"flex items-center gap-1 text-sm text-blue-600 transition-colors hover:text-blue-800 disabled:cursor-not-allowed disabled:opacity-50",disabled:q.value,title:"刷新账号列表",type:"button",onClick:B},[e("i",{class:T(["fas",q.value?"fa-spinner fa-spin":"fa-sync-alt","text-xs"])},null,2),e("span",null,m(q.value?"刷新中...":"刷新账号"),1)],8,fs)]),e("div",gs,[e("div",null,[s[67]||(s[67]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600"},"Claude 专属账号",-1)),xe(Ae,{modelValue:i.claudeAccountId,"onUpdate:modelValue":s[22]||(s[22]=c=>i.claudeAccountId=c),accounts:C.value.claude,"default-option-text":"使用共享账号池",disabled:i.permissions==="gemini",groups:C.value.claudeGroups,placeholder:"请选择Claude账号",platform:"claude"},null,8,["modelValue","accounts","disabled","groups"])]),e("div",null,[s[68]||(s[68]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600"},"Gemini 专属账号",-1)),xe(Ae,{modelValue:i.geminiAccountId,"onUpdate:modelValue":s[23]||(s[23]=c=>i.geminiAccountId=c),accounts:C.value.gemini,"default-option-text":"使用共享账号池",disabled:i.permissions==="claude",groups:C.value.geminiGroups,placeholder:"请选择Gemini账号",platform:"gemini"},null,8,["modelValue","accounts","disabled","groups"])])]),s[69]||(s[69]=e("p",{class:"mt-2 text-xs text-gray-500"}," 选择专属账号后，此API Key将只使用该账号，不选择则使用共享账号池 ",-1))]),e("div",null,[e("div",ys,[S(e("input",{id:"enableModelRestriction","onUpdate:modelValue":s[24]||(s[24]=c=>i.enableModelRestriction=c),class:"h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500",type:"checkbox"},null,512),[[ge,i.enableModelRestriction]]),s[70]||(s[70]=e("label",{class:"ml-2 cursor-pointer text-sm font-semibold text-gray-700",for:"enableModelRestriction"}," 启用模型限制 ",-1))]),i.enableModelRestriction?(a(),d("div",bs,[e("div",null,[s[73]||(s[73]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700"},"限制的模型列表",-1)),e("div",vs,[(a(!0),d(z,null,N(i.restrictedModels,(c,j)=>(a(),d("span",{key:j,class:"inline-flex items-center rounded-full bg-red-100 px-2 py-1 text-xs text-red-800"},[k(m(c)+" ",1),e("button",{class:"ml-1 text-red-600 hover:text-red-800",type:"button",onClick:Z=>H(j)},s[71]||(s[71]=[e("i",{class:"fas fa-times text-xs"},null,-1)]),8,ws)]))),128)),i.restrictedModels.length===0?(a(),d("span",hs," 暂无限制的模型 ")):b("",!0)]),e("div",$s,[S(e("input",{"onUpdate:modelValue":s[25]||(s[25]=c=>i.modelInput=c),class:"form-input flex-1 text-sm",placeholder:"输入模型名称，按回车添加",type:"text",onKeydown:ke(re(ee,["prevent"]),["enter"])},null,40,ks),[[Y,i.modelInput]]),e("button",{class:"rounded-lg bg-red-500 px-3 py-1.5 text-sm text-white transition-colors hover:bg-red-600",type:"button",onClick:ee},s[72]||(s[72]=[e("i",{class:"fas fa-plus"},null,-1)]))]),s[74]||(s[74]=e("p",{class:"mt-1 text-xs text-gray-500"},"例如：claude-opus-4-20250514",-1))])])):b("",!0)]),e("div",null,[e("div",As,[S(e("input",{id:"enableClientRestriction","onUpdate:modelValue":s[26]||(s[26]=c=>i.enableClientRestriction=c),class:"h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500",type:"checkbox"},null,512),[[ge,i.enableClientRestriction]]),s[75]||(s[75]=e("label",{class:"ml-2 cursor-pointer text-sm font-semibold text-gray-700",for:"enableClientRestriction"}," 启用客户端限制 ",-1))]),i.enableClientRestriction?(a(),d("div",Cs,[e("div",null,[s[76]||(s[76]=e("label",{class:"mb-2 block text-xs font-medium text-gray-700"},"允许的客户端",-1)),e("div",Ks,[(a(!0),d(z,null,N(r.value,c=>(a(),d("div",{key:c.id,class:"flex items-start"},[S(e("input",{id:`client_${c.id}`,"onUpdate:modelValue":s[27]||(s[27]=j=>i.allowedClients=j),class:"mt-0.5 h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500",type:"checkbox",value:c.id},null,8,_s),[[ge,i.allowedClients]]),e("label",{class:"ml-2 flex-1 cursor-pointer",for:`client_${c.id}`},[e("span",Ls,m(c.name),1),e("span",Is,m(c.description),1)],8,Ds)]))),128))])])])):b("",!0)]),e("div",Ms,[e("button",{class:"flex-1 rounded-lg bg-gray-100 px-4 py-2.5 text-sm font-semibold text-gray-700 transition-colors hover:bg-gray-200",type:"button",onClick:s[28]||(s[28]=c=>l.$emit("close"))}," 取消 "),e("button",{class:"btn btn-primary flex-1 px-4 py-2.5 text-sm font-semibold",disabled:w.value,type:"submit"},[w.value?(a(),d("div",Rs)):(a(),d("i",Ss)),k(" "+m(w.value?"创建中...":"创建"),1)],8,Ts)])],32)])])]))}},Ps=de(js,[["__scopeId","data-v-dd31c005"]]),Es={class:"modal fixed inset-0 z-50 flex items-center justify-center p-3 sm:p-4"},Vs={class:"modal-content mx-auto flex max-h-[90vh] w-full max-w-4xl flex-col p-4 sm:p-6 md:p-8"},qs={class:"mb-4 flex items-center justify-between sm:mb-6"},Us=["value"],Ws={class:"space-y-4"},Os={key:0},Fs={class:"flex flex-wrap gap-2"},Gs=["onClick"],zs={key:1},Bs={class:"flex flex-wrap gap-2"},Hs=["onClick"],Ns={class:"flex gap-2"},Ys=["onKeypress"],Qs={class:"rounded-lg border border-blue-200 bg-blue-50 p-3"},Js={class:"space-y-2"},Xs={class:"grid grid-cols-1 gap-2 lg:grid-cols-3"},Zs={class:"space-y-3"},el={class:"flex gap-2"},tl={class:"flex gap-4"},sl={class:"flex cursor-pointer items-center"},ll={class:"flex cursor-pointer items-center"},ol={class:"flex cursor-pointer items-center"},nl={class:"mb-3 flex items-center justify-between"},il=["disabled"],al={class:"grid grid-cols-1 gap-3"},rl={class:"mb-3 flex items-center"},dl={key:0,class:"space-y-3"},ul={class:"mb-3 flex min-h-[32px] flex-wrap gap-2 rounded-lg border border-gray-200 bg-gray-50 p-2"},cl=["onClick"],ml={key:0,class:"text-sm text-gray-400"},pl={class:"space-y-3"},xl={class:"flex flex-wrap gap-2"},fl=["onClick"],gl={key:0,class:"text-sm italic text-gray-400"},yl={class:"flex gap-2"},bl=["onKeydown"],vl={class:"mb-3 flex items-center"},wl={key:0,class:"space-y-3"},hl={class:"space-y-2"},$l=["id","value"],kl=["for"],Al={class:"text-sm font-medium text-gray-700"},Cl={class:"block text-xs text-gray-500"},Kl={class:"flex gap-3 pt-4"},_l=["disabled"],Dl={key:0,class:"loading-spinner mr-2"},Ll={key:1,class:"fas fa-save mr-2"},Il={__name:"EditApiKeyModal",props:{apiKey:{type:Object,required:!0},accounts:{type:Object,default:()=>({claude:[],gemini:[]})}},emits:["close","success"],setup(f,{emit:W}){const p=f,R=W,I=Te(),g=He(),w=A(!1),q=A(!1),C=A({claude:[],gemini:[],claudeGroups:[],geminiGroups:[]}),E=A([]),L=A(""),v=A([]),K=P(()=>v.value.filter(D=>!r.tags.includes(D))),r=Ke({name:"",tokenLimit:"",rateLimitWindow:"",rateLimitRequests:"",concurrencyLimit:"",dailyCostLimit:"",permissions:"all",claudeAccountId:"",geminiAccountId:"",enableModelRestriction:!1,restrictedModels:[],modelInput:"",enableClientRestriction:!1,allowedClients:[],tags:[]}),i=()=>{r.modelInput&&!r.restrictedModels.includes(r.modelInput)&&(r.restrictedModels.push(r.modelInput),r.modelInput="")},B=D=>{r.restrictedModels.splice(D,1)},$=A(["claude-opus-4-20250514","claude-opus-4-1-20250805"]),y=P(()=>$.value.filter(D=>!r.restrictedModels.includes(D))),x=D=>{r.restrictedModels.includes(D)||r.restrictedModels.push(D)},O=()=>{if(L.value&&L.value.trim()){const D=L.value.trim();r.tags.includes(D)||r.tags.push(D),L.value=""}},ee=D=>{r.tags.includes(D)||r.tags.push(D)},H=D=>{r.tags.splice(D,1)},J=async()=>{w.value=!0;try{const D={tokenLimit:r.tokenLimit!==""&&r.tokenLimit!==null?parseInt(r.tokenLimit):0,rateLimitWindow:r.rateLimitWindow!==""&&r.rateLimitWindow!==null?parseInt(r.rateLimitWindow):0,rateLimitRequests:r.rateLimitRequests!==""&&r.rateLimitRequests!==null?parseInt(r.rateLimitRequests):0,concurrencyLimit:r.concurrencyLimit!==""&&r.concurrencyLimit!==null?parseInt(r.concurrencyLimit):0,dailyCostLimit:r.dailyCostLimit!==""&&r.dailyCostLimit!==null?parseFloat(r.dailyCostLimit):0,permissions:r.permissions,tags:r.tags};r.claudeAccountId?r.claudeAccountId.startsWith("console:")?(D.claudeConsoleAccountId=r.claudeAccountId.substring(8),D.claudeAccountId=null):(r.claudeAccountId.startsWith("group:"),D.claudeAccountId=r.claudeAccountId,D.claudeConsoleAccountId=null):(D.claudeAccountId=null,D.claudeConsoleAccountId=null),r.geminiAccountId?D.geminiAccountId=r.geminiAccountId:D.geminiAccountId=null,D.enableModelRestriction=r.enableModelRestriction,D.restrictedModels=r.restrictedModels,D.enableClientRestriction=r.enableClientRestriction,D.allowedClients=r.allowedClients;const n=await G.put(`/admin/api-keys/${p.apiKey.id}`,D);n.success?(R("success"),R("close")):V(n.message||"更新失败","error")}catch{V("更新失败","error")}finally{w.value=!1}},X=async()=>{var D,n;q.value=!0;try{const[l,s,c,j]=await Promise.all([G.get("/admin/claude-accounts"),G.get("/admin/claude-console-accounts"),G.get("/admin/gemini-accounts"),G.get("/admin/account-groups")]),Z=[];if(l.success&&((D=l.data)==null||D.forEach(F=>{Z.push({...F,platform:"claude-oauth",isDedicated:F.accountType==="dedicated"})})),s.success&&((n=s.data)==null||n.forEach(F=>{Z.push({...F,platform:"claude-console",isDedicated:F.accountType==="dedicated"})})),C.value.claude=Z,c.success&&(C.value.gemini=(c.data||[]).map(F=>({...F,isDedicated:F.accountType==="dedicated"}))),j.success){const F=j.data||[];C.value.claudeGroups=F.filter(te=>te.platform==="claude"),C.value.geminiGroups=F.filter(te=>te.platform==="gemini")}V("账号列表已刷新","success")}catch{V("刷新账号列表失败","error")}finally{q.value=!1}};return Ce(async()=>{E.value=await I.loadSupportedClients(),v.value=await g.fetchTags(),p.accounts&&(C.value={claude:p.accounts.claude||[],gemini:p.accounts.gemini||[],claudeGroups:p.accounts.claudeGroups||[],geminiGroups:p.accounts.geminiGroups||[]}),r.name=p.apiKey.name,r.tokenLimit=p.apiKey.tokenLimit||"",r.rateLimitWindow=p.apiKey.rateLimitWindow||"",r.rateLimitRequests=p.apiKey.rateLimitRequests||"",r.concurrencyLimit=p.apiKey.concurrencyLimit||"",r.dailyCostLimit=p.apiKey.dailyCostLimit||"",r.permissions=p.apiKey.permissions||"all",p.apiKey.claudeConsoleAccountId?r.claudeAccountId=`console:${p.apiKey.claudeConsoleAccountId}`:r.claudeAccountId=p.apiKey.claudeAccountId||"",r.geminiAccountId=p.apiKey.geminiAccountId||"",r.restrictedModels=p.apiKey.restrictedModels||[],r.allowedClients=p.apiKey.allowedClients||[],r.tags=p.apiKey.tags||[],r.enableModelRestriction=p.apiKey.enableModelRestriction||!1,r.enableClientRestriction=p.apiKey.enableClientRestriction||!1}),(D,n)=>(a(),le(fe,{to:"body"},[e("div",Es,[e("div",Vs,[e("div",qs,[n[22]||(n[22]=e("div",{class:"flex items-center gap-2 sm:gap-3"},[e("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 sm:h-10 sm:w-10 sm:rounded-xl"},[e("i",{class:"fas fa-edit text-sm text-white sm:text-base"})]),e("h3",{class:"text-lg font-bold text-gray-900 sm:text-xl"},"编辑 API Key")],-1)),e("button",{class:"p-1 text-gray-400 transition-colors hover:text-gray-600",onClick:n[0]||(n[0]=l=>D.$emit("close"))},n[21]||(n[21]=[e("i",{class:"fas fa-times text-lg sm:text-xl"},null,-1)]))]),e("form",{class:"modal-scroll-content custom-scrollbar flex-1 space-y-4 sm:space-y-6",onSubmit:re(J,["prevent"])},[e("div",null,[n[23]||(n[23]=e("label",{class:"mb-1.5 block text-xs font-semibold text-gray-700 sm:mb-3 sm:text-sm"},"名称",-1)),e("input",{class:"form-input w-full cursor-not-allowed bg-gray-100 text-sm",disabled:"",type:"text",value:r.name},null,8,Us),n[24]||(n[24]=e("p",{class:"mt-1 text-xs text-gray-500 sm:mt-2"},"名称不可修改",-1))]),e("div",null,[n[32]||(n[32]=e("label",{class:"mb-1.5 block text-xs font-semibold text-gray-700 sm:mb-3 sm:text-sm"},"标签",-1)),e("div",Ws,[r.tags.length>0?(a(),d("div",Os,[n[26]||(n[26]=e("div",{class:"mb-2 text-xs font-medium text-gray-600"},"已选择的标签:",-1)),e("div",Fs,[(a(!0),d(z,null,N(r.tags,(l,s)=>(a(),d("span",{key:"selected-"+s,class:"inline-flex items-center gap-1 rounded-full bg-blue-100 px-3 py-1 text-sm text-blue-800"},[k(m(l)+" ",1),e("button",{class:"ml-1 hover:text-blue-900",type:"button",onClick:c=>H(s)},n[25]||(n[25]=[e("i",{class:"fas fa-times text-xs"},null,-1)]),8,Gs)]))),128))])])):b("",!0),K.value.length>0?(a(),d("div",zs,[n[28]||(n[28]=e("div",{class:"mb-2 text-xs font-medium text-gray-600"},"点击选择已有标签:",-1)),e("div",Bs,[(a(!0),d(z,null,N(K.value,l=>(a(),d("button",{key:"available-"+l,class:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-3 py-1 text-sm text-gray-700 transition-colors hover:bg-blue-100 hover:text-blue-700",type:"button",onClick:s=>ee(l)},[n[27]||(n[27]=e("i",{class:"fas fa-tag text-xs text-gray-500"},null,-1)),k(" "+m(l),1)],8,Hs))),128))])])):b("",!0),e("div",null,[n[30]||(n[30]=e("div",{class:"mb-2 text-xs font-medium text-gray-600"},"创建新标签:",-1)),e("div",Ns,[S(e("input",{"onUpdate:modelValue":n[1]||(n[1]=l=>L.value=l),class:"form-input flex-1",placeholder:"输入新标签名称",type:"text",onKeypress:ke(re(O,["prevent"]),["enter"])},null,40,Ys),[[Y,L.value]]),e("button",{class:"rounded-lg bg-green-500 px-4 py-2 text-white transition-colors hover:bg-green-600",type:"button",onClick:O},n[29]||(n[29]=[e("i",{class:"fas fa-plus"},null,-1)]))])]),n[31]||(n[31]=e("p",{class:"text-xs text-gray-500"},"用于标记不同团队或用途，方便筛选管理",-1))])]),e("div",Qs,[n[40]||(n[40]=e("div",{class:"mb-2 flex items-center gap-2"},[e("div",{class:"flex h-6 w-6 flex-shrink-0 items-center justify-center rounded bg-blue-500"},[e("i",{class:"fas fa-tachometer-alt text-xs text-white"})]),e("h4",{class:"text-sm font-semibold text-gray-800"},"速率限制设置 (可选)")],-1)),e("div",Js,[e("div",Xs,[e("div",null,[n[33]||(n[33]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700"},"时间窗口 (分钟)",-1)),S(e("input",{"onUpdate:modelValue":n[2]||(n[2]=l=>r.rateLimitWindow=l),class:"form-input w-full text-sm",min:"1",placeholder:"无限制",type:"number"},null,512),[[Y,r.rateLimitWindow]]),n[34]||(n[34]=e("p",{class:"ml-2 mt-0.5 text-xs text-gray-500"},"时间段单位",-1))]),e("div",null,[n[35]||(n[35]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700"},"请求次数限制",-1)),S(e("input",{"onUpdate:modelValue":n[3]||(n[3]=l=>r.rateLimitRequests=l),class:"form-input w-full text-sm",min:"1",placeholder:"无限制",type:"number"},null,512),[[Y,r.rateLimitRequests]]),n[36]||(n[36]=e("p",{class:"ml-2 mt-0.5 text-xs text-gray-500"},"窗口内最大请求",-1))]),e("div",null,[n[37]||(n[37]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700"},"Token 限制",-1)),S(e("input",{"onUpdate:modelValue":n[4]||(n[4]=l=>r.tokenLimit=l),class:"form-input w-full text-sm",placeholder:"无限制",type:"number"},null,512),[[Y,r.tokenLimit]]),n[38]||(n[38]=e("p",{class:"ml-2 mt-0.5 text-xs text-gray-500"},"窗口内最大Token",-1))])]),n[39]||(n[39]=e("div",{class:"rounded-lg bg-blue-100 p-2"},[e("h5",{class:"mb-1 text-xs font-semibold text-blue-800"},"💡 使用示例"),e("div",{class:"space-y-0.5 text-xs text-blue-700"},[e("div",null,[e("strong",null,"示例1:"),k(" 时间窗口=60，请求次数=1000 → 每60分钟最多1000次请求 ")]),e("div",null,[e("strong",null,"示例2:"),k(" 时间窗口=1，Token=10000 → 每分钟最多10,000个Token ")]),e("div",null,[e("strong",null,"示例3:"),k(" 窗口=30，请求=50，Token=100000 → 每30分钟50次请求且不超10万Token ")])])],-1))])]),e("div",null,[n[42]||(n[42]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700"},"每日费用限制 (美元)",-1)),e("div",Zs,[e("div",el,[e("button",{class:"rounded-lg bg-gray-100 px-3 py-1 text-sm font-medium hover:bg-gray-200",type:"button",onClick:n[5]||(n[5]=l=>r.dailyCostLimit="50")}," $50 "),e("button",{class:"rounded-lg bg-gray-100 px-3 py-1 text-sm font-medium hover:bg-gray-200",type:"button",onClick:n[6]||(n[6]=l=>r.dailyCostLimit="100")}," $100 "),e("button",{class:"rounded-lg bg-gray-100 px-3 py-1 text-sm font-medium hover:bg-gray-200",type:"button",onClick:n[7]||(n[7]=l=>r.dailyCostLimit="200")}," $200 "),e("button",{class:"rounded-lg bg-gray-100 px-3 py-1 text-sm font-medium hover:bg-gray-200",type:"button",onClick:n[8]||(n[8]=l=>r.dailyCostLimit="")}," 自定义 ")]),S(e("input",{"onUpdate:modelValue":n[9]||(n[9]=l=>r.dailyCostLimit=l),class:"form-input w-full",min:"0",placeholder:"0 表示无限制",step:"0.01",type:"number"},null,512),[[Y,r.dailyCostLimit]]),n[41]||(n[41]=e("p",{class:"text-xs text-gray-500"}," 设置此 API Key 每日的费用限制，超过限制将拒绝请求，0 或留空表示无限制 ",-1))])]),e("div",null,[n[43]||(n[43]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700"},"并发限制",-1)),S(e("input",{"onUpdate:modelValue":n[10]||(n[10]=l=>r.concurrencyLimit=l),class:"form-input w-full",min:"0",placeholder:"0 表示无限制",type:"number"},null,512),[[Y,r.concurrencyLimit]]),n[44]||(n[44]=e("p",{class:"mt-2 text-xs text-gray-500"},"设置此 API Key 可同时处理的最大请求数",-1))]),e("div",null,[n[48]||(n[48]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700"},"服务权限",-1)),e("div",tl,[e("label",sl,[S(e("input",{"onUpdate:modelValue":n[11]||(n[11]=l=>r.permissions=l),class:"mr-2",type:"radio",value:"all"},null,512),[[pe,r.permissions]]),n[45]||(n[45]=e("span",{class:"text-sm text-gray-700"},"全部服务",-1))]),e("label",ll,[S(e("input",{"onUpdate:modelValue":n[12]||(n[12]=l=>r.permissions=l),class:"mr-2",type:"radio",value:"claude"},null,512),[[pe,r.permissions]]),n[46]||(n[46]=e("span",{class:"text-sm text-gray-700"},"仅 Claude",-1))]),e("label",ol,[S(e("input",{"onUpdate:modelValue":n[13]||(n[13]=l=>r.permissions=l),class:"mr-2",type:"radio",value:"gemini"},null,512),[[pe,r.permissions]]),n[47]||(n[47]=e("span",{class:"text-sm text-gray-700"},"仅 Gemini",-1))])]),n[49]||(n[49]=e("p",{class:"mt-2 text-xs text-gray-500"},"控制此 API Key 可以访问哪些服务",-1))]),e("div",null,[e("div",nl,[n[50]||(n[50]=e("label",{class:"text-sm font-semibold text-gray-700"},"专属账号绑定",-1)),e("button",{class:"flex items-center gap-1 text-sm text-blue-600 transition-colors hover:text-blue-800 disabled:cursor-not-allowed disabled:opacity-50",disabled:q.value,title:"刷新账号列表",type:"button",onClick:X},[e("i",{class:T(["fas",q.value?"fa-spinner fa-spin":"fa-sync-alt","text-xs"])},null,2),e("span",null,m(q.value?"刷新中...":"刷新账号"),1)],8,il)]),e("div",al,[e("div",null,[n[51]||(n[51]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600"},"Claude 专属账号",-1)),xe(Ae,{modelValue:r.claudeAccountId,"onUpdate:modelValue":n[14]||(n[14]=l=>r.claudeAccountId=l),accounts:C.value.claude,"default-option-text":"使用共享账号池",disabled:r.permissions==="gemini",groups:C.value.claudeGroups,placeholder:"请选择Claude账号",platform:"claude"},null,8,["modelValue","accounts","disabled","groups"])]),e("div",null,[n[52]||(n[52]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600"},"Gemini 专属账号",-1)),xe(Ae,{modelValue:r.geminiAccountId,"onUpdate:modelValue":n[15]||(n[15]=l=>r.geminiAccountId=l),accounts:C.value.gemini,"default-option-text":"使用共享账号池",disabled:r.permissions==="claude",groups:C.value.geminiGroups,placeholder:"请选择Gemini账号",platform:"gemini"},null,8,["modelValue","accounts","disabled","groups"])])]),n[53]||(n[53]=e("p",{class:"mt-2 text-xs text-gray-500"},"修改绑定账号将影响此API Key的请求路由",-1))]),e("div",null,[e("div",rl,[S(e("input",{id:"editEnableModelRestriction","onUpdate:modelValue":n[16]||(n[16]=l=>r.enableModelRestriction=l),class:"h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500",type:"checkbox"},null,512),[[ge,r.enableModelRestriction]]),n[54]||(n[54]=e("label",{class:"ml-2 cursor-pointer text-sm font-semibold text-gray-700",for:"editEnableModelRestriction"}," 启用模型限制 ",-1))]),r.enableModelRestriction?(a(),d("div",dl,[e("div",null,[n[57]||(n[57]=e("label",{class:"mb-2 block text-sm font-medium text-gray-600"},"限制的模型列表",-1)),e("div",ul,[(a(!0),d(z,null,N(r.restrictedModels,(l,s)=>(a(),d("span",{key:s,class:"inline-flex items-center rounded-full bg-red-100 px-3 py-1 text-sm text-red-800"},[k(m(l)+" ",1),e("button",{class:"ml-2 text-red-600 hover:text-red-800",type:"button",onClick:c=>B(s)},n[55]||(n[55]=[e("i",{class:"fas fa-times text-xs"},null,-1)]),8,cl)]))),128)),r.restrictedModels.length===0?(a(),d("span",ml," 暂无限制的模型 ")):b("",!0)]),e("div",pl,[e("div",xl,[(a(!0),d(z,null,N(y.value,l=>(a(),d("button",{key:l,class:"flex-shrink-0 rounded-lg bg-gray-100 px-3 py-1 text-xs text-gray-700 transition-colors hover:bg-gray-200 sm:text-sm",type:"button",onClick:s=>x(l)},m(l),9,fl))),128)),y.value.length===0?(a(),d("span",gl," 所有常用模型已在限制列表中 ")):b("",!0)]),e("div",yl,[S(e("input",{"onUpdate:modelValue":n[17]||(n[17]=l=>r.modelInput=l),class:"form-input flex-1",placeholder:"输入模型名称，按回车添加",type:"text",onKeydown:ke(re(i,["prevent"]),["enter"])},null,40,bl),[[Y,r.modelInput]]),e("button",{class:"rounded-lg bg-red-500 px-4 py-2 text-white transition-colors hover:bg-red-600",type:"button",onClick:i},n[56]||(n[56]=[e("i",{class:"fas fa-plus"},null,-1)]))])]),n[58]||(n[58]=e("p",{class:"mt-2 text-xs text-gray-500"}," 设置此API Key无法访问的模型，例如：claude-opus-4-20250514 ",-1))])])):b("",!0)]),e("div",null,[e("div",vl,[S(e("input",{id:"editEnableClientRestriction","onUpdate:modelValue":n[18]||(n[18]=l=>r.enableClientRestriction=l),class:"h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500",type:"checkbox"},null,512),[[ge,r.enableClientRestriction]]),n[59]||(n[59]=e("label",{class:"ml-2 cursor-pointer text-sm font-semibold text-gray-700",for:"editEnableClientRestriction"}," 启用客户端限制 ",-1))]),r.enableClientRestriction?(a(),d("div",wl,[e("div",null,[n[60]||(n[60]=e("label",{class:"mb-2 block text-sm font-medium text-gray-600"},"允许的客户端",-1)),n[61]||(n[61]=e("p",{class:"mb-3 text-xs text-gray-500"},"勾选允许使用此API Key的客户端",-1)),e("div",hl,[(a(!0),d(z,null,N(E.value,l=>(a(),d("div",{key:l.id,class:"flex items-start"},[S(e("input",{id:`edit_client_${l.id}`,"onUpdate:modelValue":n[19]||(n[19]=s=>r.allowedClients=s),class:"mt-0.5 h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500",type:"checkbox",value:l.id},null,8,$l),[[ge,r.allowedClients]]),e("label",{class:"ml-2 flex-1 cursor-pointer",for:`edit_client_${l.id}`},[e("span",Al,m(l.name),1),e("span",Cl,m(l.description),1)],8,kl)]))),128))])])])):b("",!0)]),e("div",Kl,[e("button",{class:"flex-1 rounded-xl bg-gray-100 px-6 py-3 font-semibold text-gray-700 transition-colors hover:bg-gray-200",type:"button",onClick:n[20]||(n[20]=l=>D.$emit("close"))}," 取消 "),e("button",{class:"btn btn-primary flex-1 px-6 py-3 font-semibold",disabled:w.value,type:"submit"},[w.value?(a(),d("div",Dl)):(a(),d("i",Ll)),k(" "+m(w.value?"保存中...":"保存修改"),1)],8,_l)])],32)])])]))}},Ml=de(Il,[["__scopeId","data-v-04f8bd5c"]]),Tl={class:"modal fixed inset-0 z-50 flex items-center justify-center p-4"},Rl={class:"modal-content mx-auto flex max-h-[90vh] w-full max-w-md flex-col p-8"},Sl={class:"mb-6 flex items-center justify-between"},jl={class:"modal-scroll-content custom-scrollbar flex-1 space-y-6"},Pl={class:"rounded-lg border border-blue-200 bg-blue-50 p-4"},El={class:"flex items-start gap-3"},Vl={class:"text-sm text-gray-700"},ql={class:"mt-1 text-xs text-gray-600"},Ul={key:0,class:"mt-3"},Wl=["min"],Ol={key:1,class:"mt-2 text-xs text-gray-500"},Fl={class:"flex gap-3 pt-4"},Gl=["disabled"],zl={key:0,class:"loading-spinner mr-2"},Bl={key:1,class:"fas fa-clock mr-2"},Hl={__name:"RenewApiKeyModal",props:{apiKey:{type:Object,required:!0}},emits:["close","success"],setup(f,{emit:W}){const p=f,R=W,I=A(!1),g=Ke({renewDuration:"30d",customExpireDate:"",newExpiresAt:null}),w=P(()=>{const v=new Date;return p.apiKey.expiresAt&&new Date(p.apiKey.expiresAt)>v?new Date(p.apiKey.expiresAt).toISOString().slice(0,16):(v.setMinutes(v.getMinutes()+1),v.toISOString().slice(0,16))}),q=v=>new Date(v).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),C=()=>{if(!g.renewDuration){g.newExpiresAt=null;return}if(g.renewDuration==="permanent"){g.newExpiresAt=null;return}if(g.renewDuration==="custom")return;const v=p.apiKey.expiresAt&&new Date(p.apiKey.expiresAt)>new Date?new Date(p.apiKey.expiresAt):new Date,r=g.renewDuration.match(/(\d+)([dhmy])/);if(r){const[,i,B]=r,$=parseInt(i);switch(B){case"d":v.setDate(v.getDate()+$);break;case"h":v.setHours(v.getHours()+$);break;case"m":v.setMonth(v.getMonth()+$);break;case"y":v.setFullYear(v.getFullYear()+$);break}g.newExpiresAt=v.toISOString()}},E=()=>{g.customExpireDate&&(g.newExpiresAt=new Date(g.customExpireDate).toISOString())},L=async()=>{I.value=!0;try{const v={expiresAt:g.renewDuration==="permanent"?null:g.newExpiresAt},K=await G.put(`/admin/api-keys/${p.apiKey.id}`,v);K.success?(V("API Key 续期成功","success"),R("success"),R("close")):V(K.message||"续期失败","error")}catch{V("续期失败","error")}finally{I.value=!1}};return C(),(v,K)=>(a(),le(fe,{to:"body"},[e("div",Tl,[e("div",Rl,[e("div",Sl,[K[5]||(K[5]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-green-500 to-green-600"},[e("i",{class:"fas fa-clock text-white"})]),e("h3",{class:"text-xl font-bold text-gray-900"},"续期 API Key")],-1)),e("button",{class:"text-gray-400 transition-colors hover:text-gray-600",onClick:K[0]||(K[0]=r=>v.$emit("close"))},K[4]||(K[4]=[e("i",{class:"fas fa-times text-xl"},null,-1)]))]),e("div",jl,[e("div",Pl,[e("div",El,[K[7]||(K[7]=e("div",{class:"flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-lg bg-blue-500"},[e("i",{class:"fas fa-info text-sm text-white"})],-1)),e("div",null,[K[6]||(K[6]=e("h4",{class:"mb-1 font-semibold text-gray-800"},"API Key 信息",-1)),e("p",Vl,m(f.apiKey.name),1),e("p",ql," 当前过期时间："+m(f.apiKey.expiresAt?q(f.apiKey.expiresAt):"永不过期"),1)])])]),e("div",null,[K[9]||(K[9]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700"},"续期时长",-1)),S(e("select",{"onUpdate:modelValue":K[1]||(K[1]=r=>g.renewDuration=r),class:"form-input w-full",onChange:C},K[8]||(K[8]=[e("option",{value:"7d"},"延长 7 天",-1),e("option",{value:"30d"},"延长 30 天",-1),e("option",{value:"90d"},"延长 90 天",-1),e("option",{value:"180d"},"延长 180 天",-1),e("option",{value:"365d"},"延长 365 天",-1),e("option",{value:"custom"},"自定义日期",-1),e("option",{value:"permanent"},"设为永不过期",-1)]),544),[[be,g.renewDuration]]),g.renewDuration==="custom"?(a(),d("div",Ul,[S(e("input",{"onUpdate:modelValue":K[2]||(K[2]=r=>g.customExpireDate=r),class:"form-input w-full",min:w.value,type:"datetime-local",onChange:E},null,40,Wl),[[Y,g.customExpireDate]])])):b("",!0),g.newExpiresAt?(a(),d("p",Ol," 新的过期时间："+m(q(g.newExpiresAt)),1)):b("",!0)])]),e("div",Fl,[e("button",{class:"flex-1 rounded-xl bg-gray-100 px-6 py-3 font-semibold text-gray-700 transition-colors hover:bg-gray-200",type:"button",onClick:K[3]||(K[3]=r=>v.$emit("close"))}," 取消 "),e("button",{class:"btn btn-primary flex-1 px-6 py-3 font-semibold",disabled:I.value||!g.renewDuration,type:"button",onClick:L},[I.value?(a(),d("div",zl)):(a(),d("i",Bl)),k(" "+m(I.value?"续期中...":"确认续期"),1)],8,Gl)])])])]))}},Nl=de(Hl,[["__scopeId","data-v-2fba52a3"]]),Yl={class:"modal fixed inset-0 z-50 flex items-center justify-center p-4"},Ql={class:"modal-content custom-scrollbar mx-auto max-h-[90vh] w-full max-w-lg overflow-y-auto p-8"},Jl={class:"mb-6 space-y-4"},Xl={class:"rounded-lg border bg-gray-50 p-3"},Zl={class:"font-medium text-gray-900"},eo={key:0},to={class:"rounded-lg border bg-gray-50 p-3"},so={class:"text-gray-700"},lo={class:"relative"},oo={class:"flex min-h-[60px] items-center break-all rounded-lg border bg-gray-900 p-4 pr-14 font-mono text-sm text-white"},no={class:"absolute right-3 top-3"},io=["title"],ao={__name:"NewApiKeyModal",props:{apiKey:{type:Object,required:!0}},emits:["close"],setup(f,{emit:W}){const p=f,R=W,I=A(!1),g=()=>{I.value=!I.value},w=()=>{const L=p.apiKey.apiKey||p.apiKey.key||"";return L?I.value||L.length<=12?L:L.substring(0,8)+"●".repeat(Math.max(0,L.length-12))+L.substring(L.length-4):""},q=async()=>{const L=p.apiKey.apiKey||p.apiKey.key||"";if(!L){V("API Key 不存在","error");return}try{await navigator.clipboard.writeText(L),V("API Key 已复制到剪贴板","success")}catch(v){console.error("Failed to copy:",v);const K=document.createElement("textarea");K.value=L,document.body.appendChild(K),K.select();try{document.execCommand("copy"),V("API Key 已复制到剪贴板","success")}catch{V("复制失败，请手动复制","error")}finally{document.body.removeChild(K)}}},C=async()=>{window.showConfirm?await window.showConfirm("关闭提醒",`关闭后将无法再次查看完整的API Key，请确保已经妥善保存。

确定要关闭吗？`,"确定关闭","取消")&&R("close"):confirm(`关闭后将无法再次查看完整的API Key，请确保已经妥善保存。

确定要关闭吗？`)&&R("close")},E=async()=>{window.showConfirm?await window.showConfirm("确定要关闭吗？",`您还没有保存API Key，关闭后将无法再次查看。

建议您先复制API Key再关闭。`,"仍然关闭","返回复制")&&R("close"):confirm(`您还没有保存API Key，关闭后将无法再次查看。

确定要关闭吗？`)&&R("close")};return(L,v)=>(a(),le(fe,{to:"body"},[e("div",Yl,[e("div",Ql,[e("div",{class:"mb-6 flex items-center justify-between"},[v[1]||(v[1]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-green-500 to-green-600"},[e("i",{class:"fas fa-check text-lg text-white"})]),e("div",null,[e("h3",{class:"text-xl font-bold text-gray-900"},"API Key 创建成功"),e("p",{class:"text-sm text-gray-600"},"请妥善保存您的 API Key")])],-1)),e("button",{class:"text-gray-400 transition-colors hover:text-gray-600",title:"直接关闭（不推荐）",onClick:E},v[0]||(v[0]=[e("i",{class:"fas fa-times text-xl"},null,-1)]))]),v[7]||(v[7]=e("div",{class:"mb-6 border-l-4 border-amber-400 bg-amber-50 p-4"},[e("div",{class:"flex items-start"},[e("div",{class:"mt-0.5 flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-lg bg-amber-400"},[e("i",{class:"fas fa-exclamation-triangle text-sm text-white"})]),e("div",{class:"ml-3"},[e("h5",{class:"mb-1 font-semibold text-amber-900"},"重要提醒"),e("p",{class:"text-sm text-amber-800"}," 这是您唯一能看到完整 API Key 的机会。关闭此窗口后，系统将不再显示完整的 API Key。请立即复制并妥善保存。 ")])])],-1)),e("div",Jl,[e("div",null,[v[2]||(v[2]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700"},"API Key 名称",-1)),e("div",Xl,[e("span",Zl,m(f.apiKey.name),1)])]),f.apiKey.description?(a(),d("div",eo,[v[3]||(v[3]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700"},"备注",-1)),e("div",to,[e("span",so,m(f.apiKey.description||"无描述"),1)])])):b("",!0),e("div",null,[v[4]||(v[4]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700"},"API Key",-1)),e("div",lo,[e("div",oo,m(w()),1),e("div",no,[e("button",{class:"btn-icon-sm bg-gray-700 hover:bg-gray-800",title:I.value?"隐藏API Key":"显示完整API Key",type:"button",onClick:g},[e("i",{class:T(["fas",I.value?"fa-eye-slash":"fa-eye","text-gray-300"])},null,2)],8,io)])]),v[5]||(v[5]=e("p",{class:"mt-2 text-xs text-gray-500"}," 点击眼睛图标切换显示模式，使用下方按钮复制完整 API Key ",-1))])]),e("div",{class:"flex gap-3"},[e("button",{class:"btn btn-primary flex flex-1 items-center justify-center gap-2 px-6 py-3 font-semibold",onClick:q},v[6]||(v[6]=[e("i",{class:"fas fa-copy"},null,-1),k(" 复制 API Key ",-1)])),e("button",{class:"rounded-xl border border-gray-300 bg-gray-200 px-6 py-3 font-semibold text-gray-800 transition-colors hover:bg-gray-300",onClick:C}," 我已保存 ")])])])]))}},ro=de(ao,[["__scopeId","data-v-75e2b028"]]),uo={class:"modal fixed inset-0 z-50 flex items-center justify-center p-4"},co={class:"modal-content custom-scrollbar mx-auto max-h-[90vh] w-full max-w-2xl overflow-y-auto p-8"},mo={class:"mb-6 flex items-center justify-between"},po={class:"flex items-center gap-3"},xo={class:"text-sm text-gray-600"},fo={class:"mb-6 grid grid-cols-2 gap-4 md:grid-cols-4"},go={class:"rounded-lg border border-blue-200 bg-gradient-to-br from-blue-50 to-blue-100 p-4"},yo={class:"flex items-center justify-between"},bo={class:"mt-1 text-2xl font-bold text-blue-900"},vo={class:"rounded-lg border border-green-200 bg-gradient-to-br from-green-50 to-green-100 p-4"},wo={class:"flex items-center justify-between"},ho={class:"mt-1 truncate text-lg font-bold text-green-900"},$o={class:"rounded-lg border border-purple-200 bg-gradient-to-br from-purple-50 to-purple-100 p-4"},ko={class:"flex items-center justify-between"},Ao={class:"mt-1 text-lg font-bold text-purple-900"},Co={class:"rounded-lg border border-orange-200 bg-gradient-to-br from-orange-50 to-orange-100 p-4"},Ko={class:"flex items-center justify-between"},_o={class:"mt-1 text-lg font-bold text-orange-900"},Do={class:"mb-6"},Lo={class:"mb-3 flex items-center justify-between"},Io={class:"flex items-center gap-2"},Mo={key:0,class:"custom-scrollbar max-h-48 overflow-y-auto rounded-lg bg-gray-900 p-4"},To={class:"font-mono text-xs text-gray-300"},Ro={__name:"BatchApiKeyModal",props:{apiKeys:{type:Array,required:!0}},emits:["close"],setup(f,{emit:W}){const p=f,R=W,I=A(!1),g=P(()=>{if(p.apiKeys.length>0){const r=p.apiKeys[0],i=r.name.match(/^(.+)_\d+$/);return i?i[1]:r.name}return""}),w=()=>{if(p.apiKeys.length===0)return"未知";const r=p.apiKeys[0].permissions;return{all:"全部服务",claude:"仅 Claude",gemini:"仅 Gemini"}[r]||r},q=()=>{if(p.apiKeys.length===0)return"未知";const r=p.apiKeys[0].expiresAt;if(!r)return"永不过期";const i=new Date(r),$=Math.ceil((i-new Date)/(1e3*60*60*24));return $<=7?`${$}天`:$<=30?`${Math.ceil($/7)}周`:$<=365?`${Math.ceil($/30)}个月`:`${Math.ceil($/365)}年`},C=()=>{I.value=!I.value},E=()=>{const i=p.apiKeys.slice(0,10).map(B=>`${B.name}: ${B.apiKey||B.key||""}`);return p.apiKeys.length>10&&i.push(`... 还有 ${p.apiKeys.length-10} 个 API Key`),i.join(`
`)},L=()=>{const r=p.apiKeys.map(x=>`${x.name}: ${x.apiKey||x.key||""}`).join(`
`),i=new Blob([r],{type:"text/plain;charset=utf-8"}),B=URL.createObjectURL(i),$=document.createElement("a");$.href=B;const y=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);$.download=`api-keys-${g.value}-${y}.txt`,document.body.appendChild($),$.click(),document.body.removeChild($),URL.revokeObjectURL(B),V("API Keys 文件已下载","success")},v=async()=>{window.showConfirm?await window.showConfirm("关闭提醒",`关闭后将无法再次查看这些 API Key，请确保已经下载并妥善保存。

确定要关闭吗？`,"确定关闭","返回下载")&&R("close"):confirm(`关闭后将无法再次查看这些 API Key，请确保已经下载并妥善保存。

确定要关闭吗？`)&&R("close")},K=async()=>{window.showConfirm?await window.showConfirm("确定要关闭吗？",`您还没有下载 API Keys，关闭后将无法再次查看。

强烈建议您先下载保存。`,"仍然关闭","返回下载")&&R("close"):confirm(`您还没有下载 API Keys，关闭后将无法再次查看。

确定要关闭吗？`)&&R("close")};return(r,i)=>(a(),le(fe,{to:"body"},[e("div",uo,[e("div",co,[e("div",mo,[e("div",po,[i[1]||(i[1]=e("div",{class:"flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-green-500 to-green-600"},[e("i",{class:"fas fa-layer-group text-lg text-white"})],-1)),e("div",null,[i[0]||(i[0]=e("h3",{class:"text-xl font-bold text-gray-900"},"批量创建成功",-1)),e("p",xo,"成功创建 "+m(f.apiKeys.length)+" 个 API Key",1)])]),e("button",{class:"text-gray-400 transition-colors hover:text-gray-600",title:"直接关闭（不推荐）",onClick:K},i[2]||(i[2]=[e("i",{class:"fas fa-times text-xl"},null,-1)]))]),i[14]||(i[14]=e("div",{class:"mb-6 border-l-4 border-amber-400 bg-amber-50 p-4"},[e("div",{class:"flex items-start"},[e("div",{class:"mt-0.5 flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-lg bg-amber-400"},[e("i",{class:"fas fa-exclamation-triangle text-sm text-white"})]),e("div",{class:"ml-3"},[e("h5",{class:"mb-1 font-semibold text-amber-900"},"重要提醒"),e("p",{class:"text-sm text-amber-800"}," 这是您唯一能看到所有 API Key 的机会。关闭此窗口后，系统将不再显示完整的 API Key。请立即下载并妥善保存。 ")])])],-1)),e("div",fo,[e("div",go,[e("div",yo,[e("div",null,[i[3]||(i[3]=e("p",{class:"text-xs font-medium text-blue-600"},"创建数量",-1)),e("p",bo,m(f.apiKeys.length),1)]),i[4]||(i[4]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-lg bg-blue-500 bg-opacity-20"},[e("i",{class:"fas fa-key text-blue-600"})],-1))])]),e("div",vo,[e("div",wo,[e("div",null,[i[5]||(i[5]=e("p",{class:"text-xs font-medium text-green-600"},"基础名称",-1)),e("p",ho,m(g.value),1)]),i[6]||(i[6]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-lg bg-green-500 bg-opacity-20"},[e("i",{class:"fas fa-tag text-green-600"})],-1))])]),e("div",$o,[e("div",ko,[e("div",null,[i[7]||(i[7]=e("p",{class:"text-xs font-medium text-purple-600"},"权限范围",-1)),e("p",Ao,m(w()),1)]),i[8]||(i[8]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-lg bg-purple-500 bg-opacity-20"},[e("i",{class:"fas fa-shield-alt text-purple-600"})],-1))])]),e("div",Co,[e("div",Ko,[e("div",null,[i[9]||(i[9]=e("p",{class:"text-xs font-medium text-orange-600"},"过期时间",-1)),e("p",_o,m(q()),1)]),i[10]||(i[10]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-lg bg-orange-500 bg-opacity-20"},[e("i",{class:"fas fa-clock text-orange-600"})],-1))])])]),e("div",Do,[e("div",Lo,[i[12]||(i[12]=e("label",{class:"text-sm font-semibold text-gray-700"},"API Keys 预览",-1)),e("div",Io,[e("button",{class:"flex items-center gap-1 text-xs text-blue-600 hover:text-blue-800",type:"button",onClick:C},[e("i",{class:T(["fas",I.value?"fa-eye-slash":"fa-eye"])},null,2),k(" "+m(I.value?"隐藏":"显示")+"预览 ",1)]),i[11]||(i[11]=e("span",{class:"text-xs text-gray-500"},"（最多显示前10个）",-1))])]),I.value?(a(),d("div",Mo,[e("pre",To,m(E()),1)])):b("",!0)]),e("div",{class:"flex gap-3"},[e("button",{class:"btn btn-primary flex flex-1 items-center justify-center gap-2 px-6 py-3 font-semibold",onClick:L},i[13]||(i[13]=[e("i",{class:"fas fa-download"},null,-1),k(" 下载所有 API Keys ",-1)])),e("button",{class:"rounded-xl border border-gray-300 bg-gray-200 px-6 py-3 font-semibold text-gray-800 transition-colors hover:bg-gray-300",onClick:v}," 我已保存 ")]),i[15]||(i[15]=e("div",{class:"mt-4 rounded-lg border border-blue-200 bg-blue-50 p-3"},[e("p",{class:"flex items-start text-xs text-blue-700"},[e("i",{class:"fas fa-info-circle mr-2 mt-0.5 flex-shrink-0"}),e("span",null," 下载的文件格式为文本文件（.txt），每行包含一个 API Key。 请将文件保存在安全的位置，避免泄露。 ")])],-1))])])]))}},So=de(Ro,[["__scopeId","data-v-b0b904b9"]]),jo={key:0,class:"modal fixed inset-0 z-50 flex items-center justify-center p-4"},Po={class:"modal-content mx-auto w-full max-w-lg p-8"},Eo={class:"mb-6 flex items-center justify-between"},Vo={class:"flex items-center gap-3"},qo={class:"text-sm text-gray-600"},Uo={class:"space-y-6"},Wo={class:"rounded-lg border border-gray-200 bg-gradient-to-r from-gray-50 to-gray-100 p-4"},Oo={class:"flex items-center justify-between"},Fo={class:"text-sm font-semibold text-gray-800"},Go={class:"flex h-12 w-12 items-center justify-center rounded-lg bg-white shadow-sm"},zo={class:"mb-3 grid grid-cols-3 gap-2"},Bo=["onClick"],Ho={key:0,class:"animate-fadeIn"},No=["min"],Yo={key:1,class:"rounded-lg border border-blue-200 bg-gradient-to-r from-blue-50 to-indigo-50 p-4"},Qo={class:"flex items-center justify-between"},Jo={class:"text-sm font-semibold text-blue-900"},Xo={class:"flex gap-3 pt-2"},Zo=["disabled"],en={key:0,class:"loading-spinner mr-2"},tn={key:1,class:"fas fa-save mr-2"},sn={__name:"ExpiryEditModal",props:{show:{type:Boolean,required:!0},apiKey:{type:Object,required:!0}},emits:["close","save"],setup(f,{expose:W,emit:p}){const R=f,I=p,g=A(!1),w=Ke({expireDuration:"",customExpireDate:"",expiresAt:null}),q=[{value:"",label:"永不过期"},{value:"1d",label:"1 天"},{value:"7d",label:"7 天"},{value:"30d",label:"30 天"},{value:"90d",label:"90 天"},{value:"180d",label:"180 天"},{value:"365d",label:"1 年"},{value:"730d",label:"2 年"}],C=P(()=>{const y=new Date;return y.setMinutes(y.getMinutes()+1),y.toISOString().slice(0,16)});$e(()=>R.show,y=>{y&&E()}),$e(()=>{var y;return(y=R.apiKey)==null?void 0:y.id},y=>{y&&R.show&&E()});const E=()=>{g.value=!1,R.apiKey.expiresAt?(w.expireDuration="custom",w.customExpireDate=new Date(R.apiKey.expiresAt).toISOString().slice(0,16),w.expiresAt=R.apiKey.expiresAt):(w.expireDuration="",w.customExpireDate="",w.expiresAt=null)},L=y=>{if(w.expireDuration=y,!y){w.expiresAt=null;return}if(y==="custom")return;const x=new Date,O=y.match(/(\d+)([dhmy])/);if(O){const[,ee,H]=O,J=parseInt(ee);switch(H){case"d":x.setDate(x.getDate()+J);break;case"h":x.setHours(x.getHours()+J);break;case"m":x.setMonth(x.getMonth()+J);break;case"y":x.setFullYear(x.getFullYear()+J);break}w.expiresAt=x.toISOString()}},v=()=>{w.customExpireDate&&(w.expiresAt=new Date(w.customExpireDate).toISOString())},K=y=>y?new Date(y).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",r=y=>y?new Date(y)<new Date:!1,i=y=>{if(!y)return null;const x=new Date,ee=new Date(y)-x,H=Math.ceil(ee/(1e3*60*60*24));return ee<0?{text:"已过期",class:"text-red-600"}:H<=7?{text:`${H} 天后过期`,class:"text-orange-600"}:H<=30?{text:`${H} 天后过期`,class:"text-yellow-600"}:{text:`${Math.ceil(H/30)} 个月后过期`,class:"text-green-600"}},B=()=>{g.value=!0,I("save",{keyId:R.apiKey.id,expiresAt:w.expiresAt})};return W({resetSaving:()=>{g.value=!1}}),(y,x)=>(a(),le(fe,{to:"body"},[f.show?(a(),d("div",jo,[e("div",Po,[e("div",Eo,[e("div",Vo,[x[5]||(x[5]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-amber-500 to-orange-600"},[e("i",{class:"fas fa-clock text-white"})],-1)),e("div",null,[x[4]||(x[4]=e("h3",{class:"text-xl font-bold text-gray-900"},"修改过期时间",-1)),e("p",qo,' 为 "'+m(f.apiKey.name||"API Key")+'" 设置新的过期时间 ',1)])]),e("button",{class:"text-gray-400 transition-colors hover:text-gray-600",onClick:x[0]||(x[0]=O=>y.$emit("close"))},x[6]||(x[6]=[e("i",{class:"fas fa-times text-xl"},null,-1)]))]),e("div",Uo,[e("div",Wo,[e("div",Oo,[e("div",null,[x[9]||(x[9]=e("p",{class:"mb-1 text-xs font-medium text-gray-600"},"当前过期时间",-1)),e("p",Fo,[f.apiKey.expiresAt?(a(),d(z,{key:0},[k(m(K(f.apiKey.expiresAt))+" ",1),i(f.apiKey.expiresAt)?(a(),d("span",{key:0,class:T(["ml-2 text-xs font-normal",i(f.apiKey.expiresAt).class])}," ("+m(i(f.apiKey.expiresAt).text)+") ",3)):b("",!0)],64)):(a(),d(z,{key:1},[x[7]||(x[7]=e("i",{class:"fas fa-infinity mr-1 text-gray-500"},null,-1)),x[8]||(x[8]=k(" 永不过期 ",-1))],64))])]),e("div",Go,[e("i",{class:T(["fas fa-hourglass-half text-lg",f.apiKey.expiresAt&&r(f.apiKey.expiresAt)?"text-red-500":"text-gray-400"])},null,2)])])]),e("div",null,[x[11]||(x[11]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700"},"选择新的期限",-1)),e("div",zo,[(a(),d(z,null,N(q,O=>e("button",{key:O.value,class:T(["rounded-lg px-3 py-2 text-sm font-medium transition-all",w.expireDuration===O.value?"bg-blue-500 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"]),onClick:ee=>L(O.value)},m(O.label),11,Bo)),64)),e("button",{class:T(["rounded-lg px-3 py-2 text-sm font-medium transition-all",w.expireDuration==="custom"?"bg-blue-500 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"]),onClick:x[1]||(x[1]=O=>L("custom"))},x[10]||(x[10]=[e("i",{class:"fas fa-calendar-alt mr-1"},null,-1),k(" 自定义 ",-1)]),2)])]),w.expireDuration==="custom"?(a(),d("div",Ho,[x[12]||(x[12]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700"},"选择日期和时间",-1)),S(e("input",{"onUpdate:modelValue":x[2]||(x[2]=O=>w.customExpireDate=O),class:"form-input w-full",min:C.value,type:"datetime-local",onChange:v},null,40,No),[[Y,w.customExpireDate]]),x[13]||(x[13]=e("p",{class:"mt-2 text-xs text-gray-500"},"选择一个未来的日期和时间作为过期时间",-1))])):b("",!0),w.expiresAt!==f.apiKey.expiresAt?(a(),d("div",Yo,[e("div",Qo,[e("div",null,[x[16]||(x[16]=e("p",{class:"mb-1 text-xs font-medium text-blue-700"},[e("i",{class:"fas fa-arrow-right mr-1"}),k(" 新的过期时间 ")],-1)),e("p",Jo,[w.expiresAt?(a(),d(z,{key:0},[k(m(K(w.expiresAt))+" ",1),i(w.expiresAt)?(a(),d("span",{key:0,class:T(["ml-2 text-xs font-normal",i(w.expiresAt).class])}," ("+m(i(w.expiresAt).text)+") ",3)):b("",!0)],64)):(a(),d(z,{key:1},[x[14]||(x[14]=e("i",{class:"fas fa-infinity mr-1"},null,-1)),x[15]||(x[15]=k(" 永不过期 ",-1))],64))])]),x[17]||(x[17]=e("div",{class:"flex h-12 w-12 items-center justify-center rounded-lg bg-white shadow-sm"},[e("i",{class:"fas fa-check text-lg text-green-500"})],-1))])])):b("",!0),e("div",Xo,[e("button",{class:"flex-1 rounded-lg bg-gray-100 px-4 py-2.5 font-semibold text-gray-700 transition-colors hover:bg-gray-200",onClick:x[3]||(x[3]=O=>y.$emit("close"))}," 取消 "),e("button",{class:"btn btn-primary flex-1 px-4 py-2.5 font-semibold",disabled:g.value||w.expiresAt===f.apiKey.expiresAt,onClick:B},[g.value?(a(),d("div",en)):(a(),d("i",tn)),k(" "+m(g.value?"保存中...":"保存更改"),1)],8,Zo)])])])])):b("",!0)]))}},ln=de(sn,[["__scopeId","data-v-cfb0d627"]]),on={key:0,class:"modal fixed inset-0 z-50 flex items-center justify-center p-3 sm:p-4"},nn={class:"modal-content relative mx-auto flex max-h-[90vh] w-[95%] max-w-2xl flex-col p-4 sm:w-full sm:max-w-3xl sm:p-6 md:p-8"},an={class:"mb-4 flex items-center justify-between sm:mb-6"},rn={class:"flex items-center gap-2 sm:gap-3"},dn={class:"text-lg font-bold text-gray-900 sm:text-xl"},un={class:"modal-scroll-content custom-scrollbar flex-1 overflow-y-auto"},cn={class:"mb-6 grid grid-cols-1 gap-4 md:grid-cols-2"},mn={class:"rounded-lg border border-blue-200 bg-gradient-to-br from-blue-50 to-blue-100 p-4"},pn={class:"text-2xl font-bold text-gray-900"},xn={class:"mt-1 text-xs text-gray-600"},fn={class:"rounded-lg border border-green-200 bg-gradient-to-br from-green-50 to-green-100 p-4"},gn={class:"text-2xl font-bold text-gray-900"},yn={class:"mt-1 text-xs text-gray-600"},bn={class:"rounded-lg border border-yellow-200 bg-gradient-to-br from-yellow-50 to-yellow-100 p-4"},vn={class:"text-2xl font-bold text-gray-900"},wn={class:"mt-1 text-xs text-gray-600"},hn={class:"rounded-lg border border-purple-200 bg-gradient-to-br from-purple-50 to-purple-100 p-4"},$n={class:"space-y-1 text-sm"},kn={class:"flex justify-between"},An={class:"font-semibold"},Cn={class:"flex justify-between"},Kn={class:"font-semibold"},_n={class:"mb-6"},Dn={class:"space-y-3 rounded-lg bg-gray-50 p-4"},Ln={class:"flex items-center justify-between"},In={class:"text-sm font-semibold text-gray-900"},Mn={class:"flex items-center justify-between"},Tn={class:"text-sm font-semibold text-gray-900"},Rn={key:0,class:"flex items-center justify-between"},Sn={class:"text-sm font-semibold text-purple-600"},jn={key:1,class:"flex items-center justify-between"},Pn={class:"text-sm font-semibold text-purple-600"},En={key:0,class:"mb-6"},Vn={class:"space-y-3 rounded-lg bg-gray-50 p-4"},qn={key:0,class:"space-y-2"},Un={class:"flex items-center justify-between text-sm"},Wn={class:"font-semibold text-gray-900"},On={class:"h-2 w-full rounded-full bg-gray-200"},Fn={class:"text-right text-xs text-gray-500"},Gn={key:1,class:"flex items-center justify-between text-sm"},zn={class:"font-semibold text-purple-600"},Bn={key:2,class:"space-y-2"},Hn={class:"flex items-center justify-between text-sm"},Nn={class:"font-semibold text-indigo-600"},Yn={key:0,class:"space-y-1"},Qn={class:"flex items-center justify-between text-sm"},Jn={class:"font-semibold text-gray-900"},Xn={class:"h-2 w-full rounded-full bg-gray-200"},Zn={key:1,class:"space-y-1"},ei={class:"flex items-center justify-between text-sm"},ti={class:"font-semibold text-gray-900"},si={class:"h-2 w-full rounded-full bg-gray-200"},li={__name:"UsageDetailModal",props:{show:{type:Boolean,required:!0},apiKey:{type:Object,required:!0}},emits:["close"],setup(f,{emit:W}){const p=f,R=W,I=P(()=>{var n,l;return((l=(n=p.apiKey.usage)==null?void 0:n.total)==null?void 0:l.requests)||0}),g=P(()=>{var n,l;return((l=(n=p.apiKey.usage)==null?void 0:n.daily)==null?void 0:l.requests)||0}),w=P(()=>{var n,l;return((l=(n=p.apiKey.usage)==null?void 0:n.total)==null?void 0:l.tokens)||0}),q=P(()=>{var n,l;return((l=(n=p.apiKey.usage)==null?void 0:n.daily)==null?void 0:l.tokens)||0}),C=P(()=>{var n,l;return((l=(n=p.apiKey.usage)==null?void 0:n.total)==null?void 0:l.cost)||0}),E=P(()=>p.apiKey.dailyCost||0),L=P(()=>{var n,l;return((l=(n=p.apiKey.usage)==null?void 0:n.total)==null?void 0:l.inputTokens)||0}),v=P(()=>{var n,l;return((l=(n=p.apiKey.usage)==null?void 0:n.total)==null?void 0:l.outputTokens)||0}),K=P(()=>{var n,l;return((l=(n=p.apiKey.usage)==null?void 0:n.total)==null?void 0:l.cacheCreateTokens)||0}),r=P(()=>{var n,l;return((l=(n=p.apiKey.usage)==null?void 0:n.total)==null?void 0:l.cacheReadTokens)||0}),i=P(()=>{var n,l;return((l=(n=p.apiKey.usage)==null?void 0:n.averages)==null?void 0:l.rpm)||0}),B=P(()=>{var n,l;return((l=(n=p.apiKey.usage)==null?void 0:n.averages)==null?void 0:l.tpm)||0}),$=P(()=>p.apiKey.dailyCostLimit>0||p.apiKey.concurrencyLimit>0||p.apiKey.rateLimitWindow>0||p.apiKey.tokenLimit>0),y=P(()=>!p.apiKey.dailyCostLimit||p.apiKey.dailyCostLimit===0?0:E.value/p.apiKey.dailyCostLimit*100),x=P(()=>{if(!p.apiKey.rateLimitRequests||p.apiKey.rateLimitRequests===0)return 0;const n=(p.apiKey.currentWindowRequests||0)/p.apiKey.rateLimitRequests*100;return Math.min(n,100)}),O=P(()=>{const n=x.value;return n>=100?"bg-red-500":n>=80?"bg-yellow-500":"bg-blue-500"}),ee=P(()=>{if(!p.apiKey.tokenLimit||p.apiKey.tokenLimit===0)return 0;const n=(p.apiKey.currentWindowTokens||0)/p.apiKey.tokenLimit*100;return Math.min(n,100)}),H=P(()=>{const n=ee.value;return n>=100?"bg-red-500":n>=80?"bg-yellow-500":"bg-purple-500"}),J=n=>!n&&n!==0?"0":n.toLocaleString("zh-CN"),X=n=>n>=1e6?(n/1e6).toFixed(1)+"M":n>=1e3?(n/1e3).toFixed(1)+"K":n.toString(),D=()=>{R("close")};return(n,l)=>(a(),le(fe,{to:"body"},[f.show?(a(),d("div",on,[e("div",{class:"fixed inset-0 bg-gray-900 bg-opacity-50 backdrop-blur-sm",onClick:D}),e("div",nn,[e("div",an,[e("div",rn,[l[0]||(l[0]=e("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 sm:h-10 sm:w-10 sm:rounded-xl"},[e("i",{class:"fas fa-chart-line text-sm text-white sm:text-base"})],-1)),e("h3",dn," 使用统计详情 - "+m(f.apiKey.name),1)]),e("button",{class:"p-1 text-gray-400 transition-colors hover:text-gray-600",onClick:D},l[1]||(l[1]=[e("i",{class:"fas fa-times text-lg sm:text-xl"},null,-1)]))]),e("div",un,[e("div",cn,[e("div",mn,[l[2]||(l[2]=e("div",{class:"mb-3 flex items-center justify-between"},[e("span",{class:"text-sm font-medium text-gray-700"},"总请求数"),e("i",{class:"fas fa-paper-plane text-blue-500"})],-1)),e("div",pn,m(J(I.value)),1),e("div",xn," 今日: "+m(J(g.value))+" 次 ",1)]),e("div",fn,[l[3]||(l[3]=e("div",{class:"mb-3 flex items-center justify-between"},[e("span",{class:"text-sm font-medium text-gray-700"},"总Token数"),e("i",{class:"fas fa-coins text-green-500"})],-1)),e("div",gn,m(X(w.value)),1),e("div",yn," 今日: "+m(X(q.value)),1)]),e("div",bn,[l[4]||(l[4]=e("div",{class:"mb-3 flex items-center justify-between"},[e("span",{class:"text-sm font-medium text-gray-700"},"总费用"),e("i",{class:"fas fa-dollar-sign text-yellow-600"})],-1)),e("div",vn,"$"+m(C.value.toFixed(4)),1),e("div",wn,"今日: $"+m(E.value.toFixed(4)),1)]),e("div",hn,[l[7]||(l[7]=e("div",{class:"mb-3 flex items-center justify-between"},[e("span",{class:"text-sm font-medium text-gray-700"},"平均速率"),e("i",{class:"fas fa-tachometer-alt text-purple-500"})],-1)),e("div",$n,[e("div",kn,[l[5]||(l[5]=e("span",{class:"text-gray-600"},"RPM:",-1)),e("span",An,m(i.value),1)]),e("div",Cn,[l[6]||(l[6]=e("span",{class:"text-gray-600"},"TPM:",-1)),e("span",Kn,m(B.value),1)])])])]),e("div",_n,[l[12]||(l[12]=e("h4",{class:"mb-3 flex items-center text-sm font-semibold text-gray-700"},[e("i",{class:"fas fa-chart-pie mr-2 text-indigo-500"}),k(" Token 使用分布 ")],-1)),e("div",Dn,[e("div",Ln,[l[8]||(l[8]=e("div",{class:"flex items-center"},[e("i",{class:"fas fa-arrow-down mr-2 text-green-500"}),e("span",{class:"text-sm text-gray-600"},"输入 Token")],-1)),e("span",In,m(X(L.value)),1)]),e("div",Mn,[l[9]||(l[9]=e("div",{class:"flex items-center"},[e("i",{class:"fas fa-arrow-up mr-2 text-blue-500"}),e("span",{class:"text-sm text-gray-600"},"输出 Token")],-1)),e("span",Tn,m(X(v.value)),1)]),K.value>0?(a(),d("div",Rn,[l[10]||(l[10]=e("div",{class:"flex items-center"},[e("i",{class:"fas fa-save mr-2 text-purple-500"}),e("span",{class:"text-sm text-gray-600"},"缓存创建 Token")],-1)),e("span",Sn,m(X(K.value)),1)])):b("",!0),r.value>0?(a(),d("div",jn,[l[11]||(l[11]=e("div",{class:"flex items-center"},[e("i",{class:"fas fa-download mr-2 text-purple-500"}),e("span",{class:"text-sm text-gray-600"},"缓存读取 Token")],-1)),e("span",Pn,m(X(r.value)),1)])):b("",!0)])]),$.value?(a(),d("div",En,[l[18]||(l[18]=e("h4",{class:"mb-3 flex items-center text-sm font-semibold text-gray-700"},[e("i",{class:"fas fa-shield-alt mr-2 text-red-500"}),k(" 限制设置 ")],-1)),e("div",Vn,[f.apiKey.dailyCostLimit>0?(a(),d("div",qn,[e("div",Un,[l[13]||(l[13]=e("span",{class:"text-gray-600"},"每日费用限制",-1)),e("span",Wn," $"+m(f.apiKey.dailyCostLimit.toFixed(2)),1)]),e("div",On,[e("div",{class:T(["h-2 rounded-full transition-all duration-300",y.value>=100?"bg-red-500":y.value>=80?"bg-yellow-500":"bg-green-500"]),style:ne({width:Math.min(y.value,100)+"%"})},null,6)]),e("div",Fn," 已使用 "+m(y.value.toFixed(1))+"% ",1)])):b("",!0),f.apiKey.concurrencyLimit>0?(a(),d("div",Gn,[l[14]||(l[14]=e("span",{class:"text-gray-600"},"并发限制",-1)),e("span",zn,m(f.apiKey.currentConcurrency||0)+" / "+m(f.apiKey.concurrencyLimit),1)])):b("",!0),f.apiKey.rateLimitWindow>0?(a(),d("div",Bn,[e("div",Hn,[l[15]||(l[15]=e("span",{class:"text-gray-600"},"时间窗口",-1)),e("span",Nn,m(f.apiKey.rateLimitWindow)+" 分钟 ",1)]),f.apiKey.rateLimitRequests>0?(a(),d("div",Yn,[e("div",Qn,[l[16]||(l[16]=e("span",{class:"text-gray-600"},"请求限制",-1)),e("span",Jn,m(f.apiKey.currentWindowRequests||0)+" / "+m(f.apiKey.rateLimitRequests),1)]),e("div",Xn,[e("div",{class:T(["h-2 rounded-full transition-all duration-300",O.value]),style:ne({width:x.value+"%"})},null,6)])])):b("",!0),f.apiKey.tokenLimit>0?(a(),d("div",Zn,[e("div",ei,[l[17]||(l[17]=e("span",{class:"text-gray-600"},"Token限制",-1)),e("span",ti,m(X(f.apiKey.currentWindowTokens||0))+" / "+m(X(f.apiKey.tokenLimit)),1)]),e("div",si,[e("div",{class:T(["h-2 rounded-full transition-all duration-300",H.value]),style:ne({width:ee.value+"%"})},null,6)])])):b("",!0)])):b("",!0)])])):b("",!0)]),e("div",{class:"mt-4 flex justify-end gap-2 sm:mt-6 sm:gap-3"},[e("button",{class:"btn btn-secondary px-4 py-2 text-sm",type:"button",onClick:D}," 关闭 ")])])])):b("",!0)]))}},oi=de(li,[["__scopeId","data-v-388cff35"]]),ni={class:"tab-content"},ii={class:"card p-4 sm:p-6"},ai={class:"mb-4 flex flex-col gap-4 sm:mb-6"},ri={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},di={class:"flex flex-wrap items-center gap-2"},ui=["value"],ci={key:0,class:"py-12 text-center"},mi={key:1,class:"py-12 text-center"},pi={key:2,class:"table-container hidden md:block"},xi={class:"w-full table-fixed"},fi={class:"bg-gray-50/80 backdrop-blur-sm"},gi={key:1,class:"fas fa-sort ml-1 text-gray-400"},yi={key:1,class:"fas fa-sort ml-1 text-gray-400"},bi={class:"w-[17%] min-w-[140px] px-3 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700"},vi={key:1,class:"fas fa-sort ml-1 text-gray-400"},wi={key:1,class:"fas fa-sort ml-1 text-gray-400"},hi={key:1,class:"fas fa-sort ml-1 text-gray-400"},$i={class:"divide-y divide-gray-200/50"},ki={class:"table-row"},Ai={class:"px-3 py-4"},Ci={class:"flex items-center"},Ki={class:"min-w-0"},_i=["title"],Di=["title"],Li={class:"mt-1 truncate text-xs text-gray-500"},Ii=["title"],Mi={key:1},Ti={class:"px-3 py-4"},Ri={class:"flex flex-wrap gap-1"},Si={key:0,class:"text-xs text-gray-400"},ji={class:"whitespace-nowrap px-3 py-4"},Pi={class:"px-3 py-4"},Ei={class:"space-y-2"},Vi={class:"mb-2"},qi={class:"mb-1 flex items-center justify-between text-sm"},Ui={class:"font-semibold text-gray-900"},Wi={class:"flex items-center justify-between text-sm"},Oi={class:"font-semibold text-green-600"},Fi={key:0,class:"space-y-1"},Gi={class:"flex items-center justify-between text-xs"},zi={class:"text-gray-700"},Bi={class:"h-1.5 w-full rounded-full bg-gray-200"},Hi={key:1,class:"space-y-1"},Ni={class:"flex items-center justify-between text-xs"},Yi={class:"text-gray-700"},Qi={key:0,class:"space-y-0.5"},Ji={class:"flex items-center justify-between text-xs"},Xi={class:"text-gray-600"},Zi={class:"h-1 w-full rounded-full bg-gray-200"},ea={key:1,class:"space-y-0.5"},ta={class:"flex items-center justify-between text-xs"},sa={class:"text-gray-600"},la={class:"h-1 w-full rounded-full bg-gray-200"},oa={class:"pt-1"},na=["onClick"],ia={class:"whitespace-nowrap px-3 py-4 text-sm text-gray-500"},aa={class:"whitespace-nowrap px-3 py-4 text-sm"},ra={class:"inline-flex items-center gap-1.5"},da={key:0},ua={key:0,class:"inline-flex items-center text-red-600"},ca={key:1,class:"inline-flex items-center text-orange-600"},ma={key:2,class:"text-gray-600"},pa={key:1,class:"inline-flex items-center text-gray-400"},xa=["onClick"],fa={class:"whitespace-nowrap px-3 py-4 text-sm"},ga={class:"flex gap-1"},ya=["onClick"],ba=["onClick"],va=["onClick"],wa=["onClick"],ha=["onClick"],$a={key:0},ka={class:"bg-gray-50 px-3 py-4",colspan:"7"},Aa={key:0,class:"py-4 text-center"},Ca={class:"space-y-4"},Ka={class:"mb-4 flex items-center justify-between"},_a={class:"flex items-center gap-2"},Da={key:0,class:"rounded-full bg-gray-100 px-2 py-1 text-xs text-gray-500"},La={class:"flex items-center gap-1"},Ia={class:"flex gap-1 rounded bg-gray-100 p-1"},Ma=["onClick"],Ta={key:0,class:"py-8 text-center"},Ra={class:"mb-3 flex items-center justify-center gap-2"},Sa=["onClick"],ja={key:1,class:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3"},Pa={class:"mb-3 flex items-start justify-between"},Ea={class:"flex-1"},Va={class:"mb-1 block text-sm font-semibold text-gray-800"},qa={class:"rounded-full bg-blue-50 px-2 py-1 text-xs text-gray-500"},Ua={class:"mb-3 space-y-2"},Wa={class:"flex items-center justify-between text-sm"},Oa={class:"font-semibold text-gray-900"},Fa={class:"flex items-center justify-between text-sm"},Ga={class:"font-semibold text-green-600"},za={class:"mt-2 border-t border-gray-100 pt-2"},Ba={class:"flex items-center justify-between text-xs text-gray-500"},Ha={class:"font-medium"},Na={class:"flex items-center justify-between text-xs text-gray-500"},Ya={class:"font-medium"},Qa={key:0,class:"flex items-center justify-between text-xs text-purple-600"},Ja={class:"font-medium"},Xa={key:1,class:"flex items-center justify-between text-xs text-purple-600"},Za={class:"font-medium"},er={class:"mt-3 h-2 w-full rounded-full bg-gray-200"},tr={class:"mt-1 text-right"},sr={class:"text-xs font-medium text-indigo-600"},lr={key:2,class:"mt-4 rounded-lg border border-indigo-100 bg-gradient-to-r from-indigo-50 to-purple-50 p-3"},or={class:"flex items-center justify-between text-sm"},nr={class:"flex gap-4 text-xs"},ir={class:"text-gray-600"},ar={class:"font-semibold text-gray-800"},rr={class:"text-gray-600"},dr={class:"font-semibold text-gray-800"},ur={key:3,class:"space-y-3 md:hidden"},cr={class:"mb-3 flex items-start justify-between"},mr={class:"flex items-center gap-3"},pr={class:"text-sm font-semibold text-gray-900"},xr={class:"mt-0.5 text-xs text-gray-500"},fr={class:"mb-3 text-xs text-gray-600"},gr={key:0},yr={key:1},br={class:"mb-3 space-y-2"},vr={class:"rounded-lg bg-gray-50 p-3"},wr={class:"mb-2 flex items-center justify-between"},hr=["onClick"],$r={class:"grid grid-cols-2 gap-3"},kr={class:"text-sm font-semibold text-gray-900"},Ar={class:"text-sm font-semibold text-green-600"},Cr={key:0,class:"space-y-1"},Kr={class:"flex items-center justify-between text-xs"},_r={class:"text-gray-700"},Dr={class:"h-2 w-full rounded-full bg-gray-200"},Lr={key:1,class:"space-y-1"},Ir={class:"mb-1 text-xs text-gray-500"},Mr={key:0,class:"flex items-center gap-2"},Tr={class:"flex-1"},Rr={class:"h-1.5 w-full rounded-full bg-gray-200"},Sr={class:"w-16 text-right text-xs text-gray-600"},jr={key:1,class:"flex items-center gap-2"},Pr={class:"flex-1"},Er={class:"h-1.5 w-full rounded-full bg-gray-200"},Vr={class:"w-16 text-right text-xs text-gray-600"},qr={class:"mb-3 text-xs text-gray-500"},Ur={class:"mb-1 flex justify-between"},Wr={class:"flex items-center justify-between"},Or={class:"flex items-center gap-1"},Fr=["onClick"],Gr={key:0,class:"mb-3 flex flex-wrap gap-1"},zr={class:"mt-3 flex gap-2 border-t border-gray-100 pt-3"},Br=["onClick"],Hr=["onClick"],Nr=["onClick"],Yr=["onClick"],Qr={key:4,class:"mt-4 flex flex-col items-center justify-between gap-4 sm:mt-6 sm:flex-row"},Jr={class:"flex w-full flex-col items-center gap-3 sm:w-auto sm:flex-row"},Xr={class:"text-xs text-gray-600 sm:text-sm"},Zr={class:"flex items-center gap-2"},ed=["value"],td={class:"flex items-center gap-2"},sd=["disabled"],ld={class:"flex items-center gap-1"},od={key:1,class:"hidden px-2 text-gray-500 sm:inline"},nd=["onClick"],id={key:2,class:"hidden px-2 text-gray-500 sm:inline"},ad=["disabled"],rd={__name:"ApiKeysView",setup(f){const W=Te(),p=A([]),R=A(!1),I=A("today"),g=A(""),w=A("asc"),q=A({}),C=A({}),E=A({}),L=A([new Date(2e3,1,1,0,0,0),new Date(2e3,2,1,23,59,59)]),v=A({claude:[],gemini:[],claudeGroups:[],geminiGroups:[]}),K=A(null),r=A(null),i=A(!1),B=A(null),$=A(""),y=A([]),x=A(1),O=A(10),ee=[10,20,50,100],H=A(!1),J=A(!1),X=A(!1),D=A(!1),n=A(!1),l=A(null),s=A(null),c=A(null),j=A([]),Z=P(()=>{let u=p.value;return $.value&&(u=p.value.filter(h=>h.tags&&h.tags.includes($.value))),g.value?[...u].sort((h,o)=>{let M=h[g.value],U=o[g.value];return g.value==="status"?(M=h.isActive?1:0,U=o.isActive?1:0):g.value==="cost"?(M=parseFloat(ye(h.usage).replace("$","")),U=parseFloat(ye(o.usage).replace("$",""))):(g.value==="createdAt"||g.value==="expiresAt")&&(M=M?new Date(M).getTime():0,U=U?new Date(U).getTime():0),M<U?w.value==="asc"?-1:1:M>U?w.value==="asc"?1:-1:0}):u}),F=P(()=>{const u=Z.value.length;return Math.ceil(u/O.value)||0}),te=P(()=>{const u=[],t=x.value,h=F.value;if(h<=7)for(let o=1;o<=h;o++)u.push(o);else{let o=Math.max(1,t-2),M=Math.min(h,t+2);t<=3?M=5:t>=h-2&&(o=h-4);for(let U=o;U<=M;U++)u.push(U)}return u}),Q=P(()=>{const u=(x.value-1)*O.value,t=u+O.value;return Z.value.slice(u,t)}),oe=async()=>{try{const[u,t,h,o]=await Promise.all([G.get("/admin/claude-accounts"),G.get("/admin/claude-console-accounts"),G.get("/admin/gemini-accounts"),G.get("/admin/account-groups")]);if(u.success&&(v.value.claude=u.data||[]),t.success){const M=(t.data||[]).map(U=>({...U,platform:"claude-console"}));v.value.claude=[...v.value.claude,...M]}if(h.success&&(v.value.gemini=h.data||[]),o.success){const M=o.data||[];v.value.claudeGroups=M.filter(U=>U.platform==="claude"),v.value.geminiGroups=M.filter(U=>U.platform==="gemini")}}catch(u){console.error("加载账户列表失败:",u)}},se=async()=>{R.value=!0;try{const u=await G.get(`/admin/api-keys?timeRange=${I.value}`);if(u.success){p.value=u.data||[];const t=new Set;p.value.forEach(h=>{h.tags&&Array.isArray(h.tags)&&h.tags.forEach(o=>t.add(o))}),y.value=Array.from(t).sort()}}catch{V("加载 API Keys 失败","error")}finally{R.value=!1}},ie=u=>{g.value===u?w.value=w.value==="asc"?"desc":"asc":(g.value=u,w.value="asc")},ue=u=>!u&&u!==0?"0":u.toLocaleString("zh-CN"),ye=u=>!u||!u.total?"$0.0000":`$${(u.total.cost||0).toFixed(4)}`,_e=u=>{if(!u)return"未知账户";if(u.startsWith("group:")){const o=u.substring(6),M=v.value.claudeGroups.find(_=>_.id===o);if(M)return`分组-${M.name}`;const U=v.value.geminiGroups.find(_=>_.id===o);return U?`分组-${U.name}`:`分组-${o.substring(0,8)}`}const t=v.value.claude.find(o=>o.id===u);if(t)return`账户-${t.name}`;const h=v.value.gemini.find(o=>o.id===u);return h?`账户-${h.name}`:`账户-${u.substring(0,8)}`},ve=u=>u?new Date(u)<new Date:!1,we=u=>!u||ve(u)?!1:(new Date(u)-new Date)/(1e3*60*60*24)<=7,Re=u=>u?new Date(u).toLocaleDateString("zh-CN"):"",Ne=async u=>{q.value[u]?q.value[u]=!1:(q.value[u]=!0,E.value[u]||je(u),await he(u,!0))},he=async(u,t=!1)=>{if(!t&&C.value[u]&&C.value[u].length>0)return;const h=ce(u);try{let o=`/admin/api-keys/${u}/model-stats`;const M=new URLSearchParams;if(h.customStart&&h.customEnd)M.append("startDate",h.customStart),M.append("endDate",h.customEnd),M.append("period","custom");else{const _=h.preset==="today"||h.preset==="7days"?"daily":"monthly";M.append("period",_)}o+="?"+M.toString();const U=await G.get(o);U.success&&(C.value[u]=U.data||[])}catch{V("加载模型统计失败","error"),C.value[u]=[]}},Se=(u,t)=>{const h=t.reduce((o,M)=>o+(M.allTokens||0),0);return h===0?0:Math.round(u/h*100)},Ye=u=>u.formatted&&u.formatted.total?u.formatted.total:u.cost!==void 0?`$${u.cost.toFixed(6)}`:"$0.000000",je=u=>{const t=new Date,h=new Date(t);h.setDate(t.getDate()-6),E.value[u]={type:"preset",preset:"7days",customStart:h.toISOString().split("T")[0],customEnd:t.toISOString().split("T")[0],customRange:null,presetOptions:[{value:"today",label:"今日",days:1},{value:"7days",label:"7天",days:7},{value:"30days",label:"30天",days:30}]}},ce=u=>(E.value[u]||je(u),E.value[u]),Pe=(u,t)=>{const h=ce(t);h.type="preset",h.preset=u;const o=h.presetOptions.find(M=>M.value===u);if(o){const M=new Date,U=new Date(M);U.setDate(M.getDate()-(o.days-1)),h.customStart=U.toISOString().split("T")[0],h.customEnd=M.toISOString().split("T")[0];const _=me=>me.getFullYear()+"-"+String(me.getMonth()+1).padStart(2,"0")+"-"+String(me.getDate()).padStart(2,"0")+" 00:00:00";h.customRange=[_(U),_(M)]}he(t,!0)},Qe=(u,t)=>{const h=ce(u);t&&t.length===2?(h.type="custom",h.preset="",h.customRange=t,h.customStart=t[0].split(" ")[0],h.customEnd=t[1].split(" ")[0],he(u,!0)):t===null&&Pe("7days",u)},Je=u=>u>new Date,Xe=u=>{const t=ce(u);t.type="preset",t.preset="7days";const h=new Date,o=new Date(h);o.setDate(h.getDate()-6),t.customStart=o.toISOString().split("T")[0],t.customEnd=h.toISOString().split("T")[0],t.customRange=null,he(u,!0),V("已重置筛选条件并刷新数据","info")},Ze=async()=>{await oe(),H.value=!0},Ee=async u=>{await oe(),l.value=u,J.value=!0},Ve=u=>{s.value=u,X.value=!0},et=u=>{H.value=!1,c.value=u,D.value=!0,se()},tt=u=>{H.value=!1,j.value=u,n.value=!0,se()},st=()=>{J.value=!1,V("API Key 更新成功","success"),se()},lt=()=>{X.value=!1,V("API Key 续期成功","success"),se()},qe=async u=>{let t=!1;if(window.showConfirm?t=await window.showConfirm("删除 API Key","确定要删除这个 API Key 吗？此操作不可恢复。","确定删除","取消"):t=confirm("确定要删除这个 API Key 吗？此操作不可恢复。"),!!t)try{const h=await G.delete(`/admin/api-keys/${u}`);h.success?(V("API Key 已删除","success"),se()):V(h.message||"删除失败","error")}catch{V("删除失败","error")}},ot=u=>{const h=`${window.location.origin}/admin-next/api-stats?apiId=${u.id}`,o=document.createElement("textarea");o.value=h,o.style.position="fixed",o.style.opacity="0",o.style.left="-9999px",document.body.appendChild(o),o.select(),o.setSelectionRange(0,99999);try{document.execCommand("copy")?V("已复制统计页面链接","success"):(V("复制失败，请手动复制","error"),console.log("统计页面链接:",h))}catch(M){V("复制失败，请手动复制","error"),console.error("复制错误:",M),console.log("统计页面链接:",h)}finally{document.body.removeChild(o)}},Ue=u=>{K.value=u},We=()=>{K.value=null},nt=async({keyId:u,expiresAt:t})=>{try{const h=await G.put(`/admin/api-keys/${u}`,{expiresAt:t||null});if(h.success){V("过期时间已更新","success");const o=p.value.find(M=>M.id===u);o&&(o.expiresAt=t||null),We()}else V(h.message||"更新失败","error"),r.value&&r.value.resetSaving()}catch{V("更新失败","error"),r.value&&r.value.resetSaving()}},Oe=u=>u?new Date(u).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(/\//g,"-"):"",De=u=>{if(!u.dailyCostLimit||u.dailyCostLimit===0)return 0;const t=(u.dailyCost||0)/u.dailyCostLimit*100;return Math.min(t,100)},Fe=u=>{const t=De(u);return t>=100?"bg-red-500":t>=80?"bg-yellow-500":"bg-green-500"},Le=u=>{B.value=u,i.value=!0},ae=u=>u>=1e6?(u/1e6).toFixed(1)+"M":u>=1e3?(u/1e3).toFixed(1)+"K":u.toString(),Ie=u=>{if(!u.rateLimitRequests||u.rateLimitRequests===0)return 0;const t=(u.currentWindowRequests||0)/u.rateLimitRequests*100;return Math.min(t,100)},Ge=u=>{const t=Ie(u);return t>=100?"bg-red-500":t>=80?"bg-yellow-500":"bg-blue-500"},Me=u=>{if(!u.tokenLimit||u.tokenLimit===0)return 0;const t=(u.currentWindowTokens||0)/u.tokenLimit*100;return Math.min(t,100)},ze=u=>{const t=Me(u);return t>=100?"bg-red-500":t>=80?"bg-yellow-500":"bg-purple-500"};return $e([$,I],()=>{x.value=1}),Ce(async()=>{await Promise.all([W.loadSupportedClients(),oe(),se()])}),(u,t)=>{const h=it;return a(),d("div",ni,[e("div",ii,[e("div",ai,[t[24]||(t[24]=e("div",null,[e("h3",{class:"mb-1 text-lg font-bold text-gray-900 sm:mb-2 sm:text-xl"},"API Keys 管理"),e("p",{class:"text-sm text-gray-600 sm:text-base"},"管理和监控您的 API 密钥")],-1)),e("div",ri,[e("div",di,[S(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>I.value=o),class:"rounded-md border border-gray-200 bg-white px-3 py-2 text-sm text-gray-700 transition-colors hover:border-gray-300 focus:border-transparent focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:t[1]||(t[1]=o=>se())},t[21]||(t[21]=[e("option",{value:"today"},"今日",-1),e("option",{value:"7days"},"最近7天",-1),e("option",{value:"monthly"},"本月",-1),e("option",{value:"all"},"全部时间",-1)]),544),[[be,I.value]]),S(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>$.value=o),class:"rounded-md border border-gray-200 bg-white px-3 py-2 text-sm text-gray-700 transition-colors hover:border-gray-300 focus:border-transparent focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:t[3]||(t[3]=o=>x.value=1)},[t[22]||(t[22]=e("option",{value:""},"所有标签",-1)),(a(!0),d(z,null,N(y.value,o=>(a(),d("option",{key:o,value:o},m(o),9,ui))),128))],544),[[be,$.value]])]),e("button",{class:"btn btn-primary flex w-full items-center justify-center gap-2 px-4 py-2 text-sm sm:w-auto",onClick:re(Ze,["stop"])},t[23]||(t[23]=[e("i",{class:"fas fa-plus"},null,-1),k("创建新 Key ",-1)]))])]),R.value?(a(),d("div",ci,t[25]||(t[25]=[e("div",{class:"loading-spinner mx-auto mb-4"},null,-1),e("p",{class:"text-gray-500"},"正在加载 API Keys...",-1)]))):p.value.length===0?(a(),d("div",mi,t[26]||(t[26]=[e("div",{class:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-gray-100"},[e("i",{class:"fas fa-key text-xl text-gray-400"})],-1),e("p",{class:"text-lg text-gray-500"},"暂无 API Keys",-1),e("p",{class:"mt-2 text-sm text-gray-400"},"点击上方按钮创建您的第一个 API Key",-1)]))):(a(),d("div",pi,[e("table",xi,[e("thead",fi,[e("tr",null,[e("th",{class:"w-[25%] min-w-[200px] cursor-pointer px-3 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 hover:bg-gray-100",onClick:t[4]||(t[4]=o=>ie("name"))},[t[27]||(t[27]=k(" 名称 ",-1)),g.value==="name"?(a(),d("i",{key:0,class:T(["fas",w.value==="asc"?"fa-sort-up":"fa-sort-down","ml-1"])},null,2)):(a(),d("i",gi))]),t[34]||(t[34]=e("th",{class:"w-[10%] min-w-[80px] px-3 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700"}," 标签 ",-1)),e("th",{class:"w-[8%] min-w-[70px] cursor-pointer px-3 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 hover:bg-gray-100",onClick:t[5]||(t[5]=o=>ie("status"))},[t[28]||(t[28]=k(" 状态 ",-1)),g.value==="status"?(a(),d("i",{key:0,class:T(["fas",w.value==="asc"?"fa-sort-up":"fa-sort-down","ml-1"])},null,2)):(a(),d("i",yi))]),e("th",bi,[t[31]||(t[31]=k(" 使用统计 ",-1)),e("span",{class:"cursor-pointer rounded px-2 py-1 hover:bg-gray-100",onClick:t[6]||(t[6]=o=>ie("cost"))},[t[29]||(t[29]=k(" (费用 ",-1)),g.value==="cost"?(a(),d("i",{key:0,class:T(["fas",w.value==="asc"?"fa-sort-up":"fa-sort-down","ml-1"])},null,2)):(a(),d("i",vi)),t[30]||(t[30]=k(") ",-1))])]),e("th",{class:"w-[10%] min-w-[90px] cursor-pointer px-3 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 hover:bg-gray-100",onClick:t[7]||(t[7]=o=>ie("createdAt"))},[t[32]||(t[32]=k(" 创建时间 ",-1)),g.value==="createdAt"?(a(),d("i",{key:0,class:T(["fas",w.value==="asc"?"fa-sort-up":"fa-sort-down","ml-1"])},null,2)):(a(),d("i",wi))]),e("th",{class:"w-[10%] min-w-[90px] cursor-pointer px-3 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 hover:bg-gray-100",onClick:t[8]||(t[8]=o=>ie("expiresAt"))},[t[33]||(t[33]=k(" 过期时间 ",-1)),g.value==="expiresAt"?(a(),d("i",{key:0,class:T(["fas",w.value==="asc"?"fa-sort-up":"fa-sort-down","ml-1"])},null,2)):(a(),d("i",hi))]),t[35]||(t[35]=e("th",{class:"w-[20%] min-w-[180px] px-3 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700"}," 操作 ",-1))])]),e("tbody",$i,[(a(!0),d(z,null,N(Q.value,o=>{var M,U;return a(),d(z,{key:o.id},[e("tr",ki,[e("td",Ai,[e("div",Ci,[t[38]||(t[38]=e("div",{class:"mr-2 flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600"},[e("i",{class:"fas fa-key text-xs text-white"})],-1)),e("div",Ki,[e("div",{class:"truncate text-sm font-semibold text-gray-900",title:o.name},m(o.name),9,_i),e("div",{class:"truncate text-xs text-gray-500",title:o.id},m(o.id),9,Di),e("div",Li,[o.claudeAccountId?(a(),d("span",{key:0,title:`绑定: ${_e(o.claudeAccountId)}`},[t[36]||(t[36]=e("i",{class:"fas fa-link mr-1"},null,-1)),k(" "+m(_e(o.claudeAccountId)),1)],8,Ii)):(a(),d("span",Mi,t[37]||(t[37]=[e("i",{class:"fas fa-share-alt mr-1"},null,-1),k(" 共享池 ",-1)])))])])])]),e("td",Ti,[e("div",Ri,[(a(!0),d(z,null,N(o.tags||[],_=>(a(),d("span",{key:_,class:"inline-flex items-center rounded-full bg-blue-100 px-2 py-0.5 text-xs text-blue-800"},m(_),1))),128)),!o.tags||o.tags.length===0?(a(),d("span",Si,"无标签")):b("",!0)])]),e("td",ji,[e("span",{class:T(["inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold",o.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},[e("div",{class:T(["mr-2 h-2 w-2 rounded-full",o.isActive?"bg-green-500":"bg-red-500"])},null,2),k(" "+m(o.isActive?"活跃":"禁用"),1)],2)]),e("td",Pi,[e("div",Ei,[e("div",Vi,[e("div",qi,[t[39]||(t[39]=e("span",{class:"text-gray-600"},"今日请求",-1)),e("span",Ui,m(ue(((U=(M=o.usage)==null?void 0:M.daily)==null?void 0:U.requests)||0))+"次",1)]),e("div",Wi,[t[40]||(t[40]=e("span",{class:"text-gray-600"},"今日费用",-1)),e("span",Oi,"$"+m((o.dailyCost||0).toFixed(4)),1)])]),o.dailyCostLimit>0?(a(),d("div",Fi,[e("div",Gi,[t[41]||(t[41]=e("span",{class:"text-gray-500"},"费用限额",-1)),e("span",zi," $"+m((o.dailyCost||0).toFixed(2))+" / $"+m(o.dailyCostLimit.toFixed(2)),1)]),e("div",Bi,[e("div",{class:T(["h-1.5 rounded-full transition-all duration-300",Fe(o)]),style:ne({width:De(o)+"%"})},null,6)])])):b("",!0),o.rateLimitWindow>0?(a(),d("div",Hi,[e("div",Ni,[t[42]||(t[42]=e("span",{class:"text-gray-500"},"窗口限制",-1)),e("span",Yi,m(o.rateLimitWindow)+"分钟 ",1)]),o.rateLimitRequests>0?(a(),d("div",Qi,[e("div",Ji,[t[43]||(t[43]=e("span",{class:"text-gray-400"},"请求",-1)),e("span",Xi,m(o.currentWindowRequests||0)+"/"+m(o.rateLimitRequests),1)]),e("div",Zi,[e("div",{class:T(["h-1 rounded-full transition-all duration-300",Ge(o)]),style:ne({width:Ie(o)+"%"})},null,6)])])):b("",!0),o.tokenLimit>0?(a(),d("div",ea,[e("div",ta,[t[44]||(t[44]=e("span",{class:"text-gray-400"},"Token",-1)),e("span",sa,m(ae(o.currentWindowTokens||0))+"/"+m(ae(o.tokenLimit)),1)]),e("div",la,[e("div",{class:T(["h-1 rounded-full transition-all duration-300",ze(o)]),style:ne({width:Me(o)+"%"})},null,6)])])):b("",!0)])):b("",!0),e("div",oa,[e("button",{class:"flex w-full items-center justify-center gap-1 rounded py-1 text-xs font-medium text-blue-600 transition-colors hover:bg-blue-50 hover:text-blue-800",onClick:_=>Le(o)},t[45]||(t[45]=[e("i",{class:"fas fa-chart-line"},null,-1),k(" 查看详细统计 ",-1)]),8,na)])])]),e("td",ia,m(new Date(o.createdAt).toLocaleDateString()),1),e("td",aa,[e("div",ra,[o.expiresAt?(a(),d("span",da,[ve(o.expiresAt)?(a(),d("span",ua,t[46]||(t[46]=[e("i",{class:"fas fa-exclamation-circle mr-1"},null,-1),k(" 已过期 ",-1)]))):we(o.expiresAt)?(a(),d("span",ca,[t[47]||(t[47]=e("i",{class:"fas fa-clock mr-1"},null,-1)),k(" "+m(Re(o.expiresAt)),1)])):(a(),d("span",ma,m(Re(o.expiresAt)),1))])):(a(),d("span",pa,t[48]||(t[48]=[e("i",{class:"fas fa-infinity mr-1"},null,-1),k(" 永不过期 ",-1)]))),e("button",{class:"inline-flex h-6 w-6 items-center justify-center rounded-md text-gray-300 transition-all duration-200 hover:bg-blue-50 hover:text-blue-500",title:"编辑过期时间",onClick:re(_=>Ue(o),["stop"])},t[49]||(t[49]=[e("svg",{class:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)]),8,xa)])]),e("td",fa,[e("div",ga,[o&&o.id?(a(),d("button",{key:0,class:"rounded px-2 py-1 text-xs font-medium text-indigo-600 transition-colors hover:bg-indigo-50 hover:text-indigo-900",title:"模型使用分布",onClick:_=>Ne(o.id)},[e("i",{class:T(["fas",q.value[o.id]?"fa-chevron-up":"fa-chevron-down"])},null,2),t[50]||(t[50]=e("span",{class:"ml-1 hidden xl:inline"},"模型",-1))],8,ya)):b("",!0),e("button",{class:"rounded px-2 py-1 text-xs font-medium text-purple-600 transition-colors hover:bg-purple-50 hover:text-purple-900",title:"复制统计页面链接",onClick:_=>ot(o)},t[51]||(t[51]=[e("i",{class:"fas fa-chart-bar"},null,-1),e("span",{class:"ml-1 hidden xl:inline"},"统计",-1)]),8,ba),e("button",{class:"rounded px-2 py-1 text-xs font-medium text-blue-600 transition-colors hover:bg-blue-50 hover:text-blue-900",title:"编辑",onClick:_=>Ee(o)},t[52]||(t[52]=[e("i",{class:"fas fa-edit"},null,-1),e("span",{class:"ml-1 hidden xl:inline"},"编辑",-1)]),8,va),o.expiresAt&&(ve(o.expiresAt)||we(o.expiresAt))?(a(),d("button",{key:1,class:"rounded px-2 py-1 text-xs font-medium text-green-600 transition-colors hover:bg-green-50 hover:text-green-900",title:"续期",onClick:_=>Ve(o)},t[53]||(t[53]=[e("i",{class:"fas fa-clock"},null,-1),e("span",{class:"ml-1 hidden xl:inline"},"续期",-1)]),8,wa)):b("",!0),e("button",{class:"rounded px-2 py-1 text-xs font-medium text-red-600 transition-colors hover:bg-red-50 hover:text-red-900",title:"删除",onClick:_=>qe(o.id)},t[54]||(t[54]=[e("i",{class:"fas fa-trash"},null,-1),e("span",{class:"ml-1 hidden xl:inline"},"删除",-1)]),8,ha)])])]),o&&o.id&&q.value[o.id]?(a(),d("tr",$a,[e("td",ka,[C.value[o.id]?b("",!0):(a(),d("div",Aa,t[55]||(t[55]=[e("div",{class:"loading-spinner mx-auto"},null,-1),e("p",{class:"mt-2 text-sm text-gray-500"},"加载模型统计...",-1)]))),e("div",Ca,[e("div",Ka,[t[56]||(t[56]=e("h5",{class:"flex items-center text-sm font-semibold text-gray-700"},[e("i",{class:"fas fa-chart-pie mr-2 text-indigo-500"}),k(" 模型使用分布 ")],-1)),e("div",_a,[C.value[o.id]&&C.value[o.id].length>0?(a(),d("span",Da,m(C.value[o.id].length)+" 个模型 ",1)):b("",!0),e("div",La,[e("div",Ia,[(a(!0),d(z,null,N(ce(o.id).presetOptions,_=>(a(),d("button",{key:_.value,class:T(["rounded px-2 py-1 text-xs font-medium transition-colors",ce(o.id).preset===_.value&&ce(o.id).type==="preset"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"]),onClick:me=>Pe(_.value,o.id)},m(_.label),11,Ma))),128))]),xe(h,{class:"api-key-date-picker",clearable:!0,"default-time":L.value,"disabled-date":Je,"end-placeholder":"结束日期",format:"YYYY-MM-DD HH:mm:ss","model-value":ce(o.id).customRange,"range-separator":"至",size:"small","start-placeholder":"开始日期",style:{width:"280px"},type:"datetimerange","unlink-panels":!1,"value-format":"YYYY-MM-DD HH:mm:ss","onUpdate:modelValue":_=>Qe(o.id,_)},null,8,["default-time","model-value","onUpdate:modelValue"])])])]),C.value[o.id]&&C.value[o.id].length===0?(a(),d("div",Ta,[e("div",Ra,[t[58]||(t[58]=e("i",{class:"fas fa-chart-line text-lg text-gray-400"},null,-1)),t[59]||(t[59]=e("p",{class:"text-sm text-gray-500"},"暂无模型使用数据",-1)),e("button",{class:"ml-2 flex items-center gap-1 text-sm text-blue-500 transition-colors hover:text-blue-700",title:"重置筛选条件并刷新",onClick:_=>Xe(o.id)},t[57]||(t[57]=[e("i",{class:"fas fa-sync-alt text-xs"},null,-1),e("span",{class:"text-xs"},"刷新",-1)]),8,Sa)]),t[60]||(t[60]=e("p",{class:"text-xs text-gray-400"},"尝试调整时间范围或点击刷新重新加载数据",-1))])):C.value[o.id]&&C.value[o.id].length>0?(a(),d("div",ja,[(a(!0),d(z,null,N(C.value[o.id],_=>(a(),d("div",{key:_.model,class:"rounded-xl border border-gray-200 bg-gradient-to-br from-white to-gray-50 p-4 transition-all duration-200 hover:border-indigo-300 hover:shadow-lg"},[e("div",Pa,[e("div",Ea,[e("span",Va,m(_.model),1),e("span",qa,m(_.requests)+" 次请求",1)])]),e("div",Ua,[e("div",Wa,[t[61]||(t[61]=e("span",{class:"flex items-center text-gray-600"},[e("i",{class:"fas fa-coins mr-1 text-xs text-yellow-500"}),k(" 总Token: ")],-1)),e("span",Oa,m(ae(_.allTokens)),1)]),e("div",Fa,[t[62]||(t[62]=e("span",{class:"flex items-center text-gray-600"},[e("i",{class:"fas fa-dollar-sign mr-1 text-xs text-green-500"}),k(" 费用: ")],-1)),e("span",Ga,m(Ye(_)),1)]),e("div",za,[e("div",Ba,[t[63]||(t[63]=e("span",{class:"flex items-center"},[e("i",{class:"fas fa-arrow-down mr-1 text-green-500"}),k(" 输入: ")],-1)),e("span",Ha,m(ae(_.inputTokens)),1)]),e("div",Na,[t[64]||(t[64]=e("span",{class:"flex items-center"},[e("i",{class:"fas fa-arrow-up mr-1 text-blue-500"}),k(" 输出: ")],-1)),e("span",Ya,m(ae(_.outputTokens)),1)]),_.cacheCreateTokens>0?(a(),d("div",Qa,[t[65]||(t[65]=e("span",{class:"flex items-center"},[e("i",{class:"fas fa-save mr-1"}),k(" 缓存创建: ")],-1)),e("span",Ja,m(ae(_.cacheCreateTokens)),1)])):b("",!0),_.cacheReadTokens>0?(a(),d("div",Xa,[t[66]||(t[66]=e("span",{class:"flex items-center"},[e("i",{class:"fas fa-download mr-1"}),k(" 缓存读取: ")],-1)),e("span",Za,m(ae(_.cacheReadTokens)),1)])):b("",!0)])]),e("div",er,[e("div",{class:"h-2 rounded-full bg-gradient-to-r from-indigo-500 to-purple-600 transition-all duration-500",style:ne({width:Se(_.allTokens,C.value[o.id])+"%"})},null,4)]),e("div",tr,[e("span",sr,m(Se(_.allTokens,C.value[o.id]))+"% ",1)])]))),128))])):b("",!0),C.value[o.id]&&C.value[o.id].length>0?(a(),d("div",lr,[e("div",or,[t[69]||(t[69]=e("span",{class:"flex items-center font-semibold text-gray-700"},[e("i",{class:"fas fa-calculator mr-2 text-indigo-500"}),k(" 总计统计 ")],-1)),e("div",nr,[e("span",ir,[t[67]||(t[67]=k(" 总请求: ",-1)),e("span",ar,m(C.value[o.id].reduce((_,me)=>_+me.requests,0)),1)]),e("span",rr,[t[68]||(t[68]=k(" 总Token: ",-1)),e("span",dr,m(ae(C.value[o.id].reduce((_,me)=>_+me.allTokens,0))),1)])])])])):b("",!0)])])])):b("",!0)],64)}),128))])])])),!R.value&&Z.value.length>0?(a(),d("div",ur,[(a(!0),d(z,null,N(Q.value,o=>{var M,U;return a(),d("div",{key:o.id,class:"card p-4 transition-shadow hover:shadow-lg"},[e("div",cr,[e("div",mr,[t[70]||(t[70]=e("div",{class:"flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600"},[e("i",{class:"fas fa-key text-sm text-white"})],-1)),e("div",null,[e("h4",pr,m(o.name),1),e("p",xr,m(o.id),1)])]),e("span",{class:T(["inline-flex items-center rounded-full px-2 py-1 text-xs font-semibold",o.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},[e("div",{class:T(["mr-1.5 h-1.5 w-1.5 rounded-full",o.isActive?"bg-green-500":"bg-red-500"])},null,2),k(" "+m(o.isActive?"活跃":"已停用"),1)],2)]),e("div",fr,[o.claudeAccountId||o.claudeConsoleAccountId?(a(),d("span",gr,[t[71]||(t[71]=e("i",{class:"fas fa-link mr-1"},null,-1)),k(" 绑定: "+m(_e(o.claudeAccountId,o.claudeConsoleAccountId)),1)])):(a(),d("span",yr,t[72]||(t[72]=[e("i",{class:"fas fa-share-alt mr-1"},null,-1),k(" 使用共享池 ",-1)])))]),e("div",br,[e("div",vr,[e("div",wr,[t[74]||(t[74]=e("span",{class:"text-xs text-gray-600"},"今日使用",-1)),e("button",{class:"text-xs text-blue-600 hover:text-blue-800",onClick:_=>Le(o)},t[73]||(t[73]=[e("i",{class:"fas fa-chart-line mr-1"},null,-1),k("详情 ",-1)]),8,hr)]),e("div",$r,[e("div",null,[e("p",kr,m(ue(((U=(M=o.usage)==null?void 0:M.daily)==null?void 0:U.requests)||0))+" 次 ",1),t[75]||(t[75]=e("p",{class:"text-xs text-gray-500"},"请求",-1))]),e("div",null,[e("p",Ar," $"+m((o.dailyCost||0).toFixed(4)),1),t[76]||(t[76]=e("p",{class:"text-xs text-gray-500"},"费用",-1))])])]),o.dailyCostLimit>0?(a(),d("div",Cr,[e("div",Kr,[t[77]||(t[77]=e("span",{class:"text-gray-500"},"每日费用限额",-1)),e("span",_r," $"+m((o.dailyCost||0).toFixed(2))+" / $"+m(o.dailyCostLimit.toFixed(2)),1)]),e("div",Dr,[e("div",{class:T(["h-2 rounded-full transition-all duration-300",Fe(o)]),style:ne({width:De(o)+"%"})},null,6)])])):b("",!0),o.rateLimitWindow>0&&(o.rateLimitRequests>0||o.tokenLimit>0)?(a(),d("div",Lr,[e("div",Ir,"窗口限制 ("+m(o.rateLimitWindow)+"分钟)",1),o.rateLimitRequests>0?(a(),d("div",Mr,[t[78]||(t[78]=e("span",{class:"w-10 text-xs text-gray-500"},"请求",-1)),e("div",Tr,[e("div",Rr,[e("div",{class:T(["h-1.5 rounded-full transition-all duration-300",Ge(o)]),style:ne({width:Ie(o)+"%"})},null,6)])]),e("span",Sr,m(o.currentWindowRequests||0)+"/"+m(o.rateLimitRequests),1)])):b("",!0),o.tokenLimit>0?(a(),d("div",jr,[t[79]||(t[79]=e("span",{class:"w-10 text-xs text-gray-500"},"Token",-1)),e("div",Pr,[e("div",Er,[e("div",{class:T(["h-1.5 rounded-full transition-all duration-300",ze(o)]),style:ne({width:Me(o)+"%"})},null,6)])]),e("span",Vr,m(ae(o.currentWindowTokens||0))+"/"+m(ae(o.tokenLimit)),1)])):b("",!0)])):b("",!0)]),e("div",qr,[e("div",Ur,[t[80]||(t[80]=e("span",null,"创建时间",-1)),e("span",null,m(Oe(o.createdAt)),1)]),e("div",Wr,[t[82]||(t[82]=e("span",null,"过期时间",-1)),e("div",Or,[e("span",{class:T(we(o.expiresAt)?"font-semibold text-orange-600":"")},m(o.expiresAt?Oe(o.expiresAt):"永不过期"),3),e("button",{class:"inline-flex h-5 w-5 items-center justify-center rounded text-gray-300 transition-all duration-200 hover:bg-blue-50 hover:text-blue-500",title:"编辑过期时间",onClick:re(_=>Ue(o),["stop"])},t[81]||(t[81]=[e("svg",{class:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)]),8,Fr)])])]),o.tags&&o.tags.length>0?(a(),d("div",Gr,[(a(!0),d(z,null,N(o.tags,_=>(a(),d("span",{key:_,class:"inline-flex items-center rounded-full bg-blue-100 px-2 py-0.5 text-xs text-blue-800"},m(_),1))),128))])):b("",!0),e("div",zr,[e("button",{class:"flex flex-1 items-center justify-center gap-1 rounded-lg bg-blue-50 px-3 py-2 text-xs text-blue-600 transition-colors hover:bg-blue-100",onClick:_=>Le(o)},t[83]||(t[83]=[e("i",{class:"fas fa-chart-line"},null,-1),k(" 查看详情 ",-1)]),8,Br),e("button",{class:"flex-1 rounded-lg bg-gray-50 px-3 py-2 text-xs text-gray-600 transition-colors hover:bg-gray-100",onClick:_=>Ee(o)},t[84]||(t[84]=[e("i",{class:"fas fa-edit mr-1"},null,-1),k(" 编辑 ",-1)]),8,Hr),o.expiresAt&&(ve(o.expiresAt)||we(o.expiresAt))?(a(),d("button",{key:0,class:"flex-1 rounded-lg bg-orange-50 px-3 py-2 text-xs text-orange-600 transition-colors hover:bg-orange-100",onClick:_=>Ve(o)},t[85]||(t[85]=[e("i",{class:"fas fa-clock mr-1"},null,-1),k(" 续期 ",-1)]),8,Nr)):b("",!0),e("button",{class:"rounded-lg bg-red-50 px-3 py-2 text-xs text-red-600 transition-colors hover:bg-red-100",onClick:_=>qe(o.id)},t[86]||(t[86]=[e("i",{class:"fas fa-trash"},null,-1)]),8,Yr)])])}),128))])):b("",!0),Z.value.length>0?(a(),d("div",Qr,[e("div",Jr,[e("span",Xr," 共 "+m(Z.value.length)+" 条记录 ",1),e("div",Zr,[t[87]||(t[87]=e("span",{class:"text-xs text-gray-600 sm:text-sm"},"每页显示",-1)),S(e("select",{"onUpdate:modelValue":t[9]||(t[9]=o=>O.value=o),class:"rounded-md border border-gray-200 bg-white px-2 py-1 text-xs text-gray-700 transition-colors hover:border-gray-300 focus:border-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 sm:text-sm",onChange:t[10]||(t[10]=o=>x.value=1)},[(a(),d(z,null,N(ee,o=>e("option",{key:o,value:o},m(o),9,ed)),64))],544),[[be,O.value]]),t[88]||(t[88]=e("span",{class:"text-xs text-gray-600 sm:text-sm"},"条",-1))])]),e("div",td,[e("button",{class:"rounded-md border border-gray-300 bg-white px-3 py-1.5 text-xs font-medium text-gray-700 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50 sm:py-1 sm:text-sm",disabled:x.value===1,onClick:t[11]||(t[11]=o=>x.value--)},t[89]||(t[89]=[e("i",{class:"fas fa-chevron-left"},null,-1)]),8,sd),e("div",ld,[x.value>3?(a(),d("button",{key:0,class:"hidden rounded-md border border-gray-300 bg-white px-3 py-1 text-sm font-medium text-gray-700 hover:bg-gray-50 sm:block",onClick:t[12]||(t[12]=o=>x.value=1)}," 1 ")):b("",!0),x.value>4?(a(),d("span",od,"...")):b("",!0),(a(!0),d(z,null,N(te.value,o=>(a(),d("button",{key:o,class:T(["rounded-md px-2 py-1 text-xs font-medium sm:px-3 sm:text-sm",o===x.value?"bg-blue-600 text-white":"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50"]),onClick:M=>x.value=o},m(o),11,nd))),128)),x.value<F.value-3?(a(),d("span",id,"...")):b("",!0),F.value>1&&x.value<F.value-2?(a(),d("button",{key:3,class:"hidden rounded-md border border-gray-300 bg-white px-3 py-1 text-sm font-medium text-gray-700 hover:bg-gray-50 sm:block",onClick:t[13]||(t[13]=o=>x.value=F.value)},m(F.value),1)):b("",!0)]),e("button",{class:"rounded-md border border-gray-300 bg-white px-3 py-1.5 text-xs font-medium text-gray-700 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50 sm:py-1 sm:text-sm",disabled:x.value===F.value||F.value===0,onClick:t[14]||(t[14]=o=>x.value++)},t[90]||(t[90]=[e("i",{class:"fas fa-chevron-right"},null,-1)]),8,ad)])])):b("",!0)]),H.value?(a(),le(Ps,{key:0,accounts:v.value,onBatchSuccess:tt,onClose:t[15]||(t[15]=o=>H.value=!1),onSuccess:et},null,8,["accounts"])):b("",!0),J.value?(a(),le(Ml,{key:1,accounts:v.value,"api-key":l.value,onClose:t[16]||(t[16]=o=>J.value=!1),onSuccess:st},null,8,["accounts","api-key"])):b("",!0),X.value?(a(),le(Nl,{key:2,"api-key":s.value,onClose:t[17]||(t[17]=o=>X.value=!1),onSuccess:lt},null,8,["api-key"])):b("",!0),D.value?(a(),le(ro,{key:3,"api-key":c.value,onClose:t[18]||(t[18]=o=>D.value=!1)},null,8,["api-key"])):b("",!0),n.value?(a(),le(So,{key:4,"api-keys":j.value,onClose:t[19]||(t[19]=o=>n.value=!1)},null,8,["api-keys"])):b("",!0),xe(ln,{ref_key:"expiryEditModalRef",ref:r,"api-key":K.value||{id:null,expiresAt:null,name:""},show:!!K.value,onClose:We,onSave:nt},null,8,["api-key","show"]),xe(oi,{"api-key":B.value||{},show:i.value,onClose:t[20]||(t[20]=o=>i.value=!1)},null,8,["api-key","show"])])}}},xd=de(rd,[["__scopeId","data-v-4f201f6f"]]);export{xd as default};
